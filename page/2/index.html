<!DOCTYPE html>


<html lang="zh-CN">
  

    <head>
      <meta charset="utf-8" />
        
      <meta
        name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1"
      />
      <title> 就花荫</title>
  <meta name="generator" content="hexo-theme-ayer">
      
      <link rel="shortcut icon" href="/favicon.ico" />
       
<link rel="stylesheet" href="/dist/main.css">

      <link
        rel="stylesheet"
        href="https://cdn.jsdelivr.net/gh/Shen-Yu/cdn/css/remixicon.min.css"
      />
      
<link rel="stylesheet" href="/css/custom.css">
 
      <script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script>
       
 

      <!-- mermaid -->
      
    <link rel="alternate" href="/atom.xml" title="就花荫" type="application/atom+xml">
</head>
  </html>
</html>


<body>
  <div id="app">
    
      
    <main class="content on">
      
<section class="cover">
    
  <div class="cover-frame">
    <div class="bg-box">
      <img src="/images/cover4.jpg" alt="image frame" />
    </div>
    <div class="cover-inner text-center text-white">
      <h1><a href="/">就花荫</a></h1>
      <div id="subtitle-box">
        
        <span id="subtitle"></span>
        
      </div>
      <div>
        
      </div>
    </div>
  </div>
  <div class="cover-learn-more">
    <a href="javascript:void(0)" class="anchor"><i class="ri-arrow-down-line"></i></a>
  </div>
</section>



<script src="https://cdn.jsdelivr.net/npm/typed.js@2.0.11/lib/typed.min.js"></script>


<!-- Subtitle -->

  <script>
    try {
      var typed = new Typed("#subtitle", {
        strings: ['如你遇见这花，如我遇见你。', '', ''],
        startDelay: 0,
        typeSpeed: 200,
        loop: true,
        backSpeed: 100,
        showCursor: true
      });
    } catch (err) {
      console.log(err)
    }
  </script>
  
<div id="main">
  <section class="outer">
  
  
  

<div class="notice" style="margin-top:50px">
    <i class="ri-heart-fill"></i>
    <div class="notice-content" id="broad"></div>
</div>
<script type="text/javascript">
    fetch('https://v1.hitokoto.cn')
        .then(response => response.json())
        .then(data => {
            document.getElementById("broad").innerHTML = data.hitokoto;
        })
        .catch(console.error)
</script>

<style>
    .notice {
        padding: 20px;
        border: 1px dashed #e6e6e6;
        color: #969696;
        position: relative;
        display: inline-block;
        width: 100%;
        background: #fbfbfb50;
        border-radius: 10px;
    }

    .notice i {
        float: left;
        color: #999;
        font-size: 16px;
        padding-right: 10px;
        vertical-align: middle;
        margin-top: -2px;
    }

    .notice-content {
        display: initial;
        vertical-align: middle;
    }
</style>
  
  <article class="articles">
    
    
    
    
    <article
  id="post-eventloop"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2021/12/04/eventloop/"
    >事件循环</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2021/12/04/eventloop/" class="article-date">
  <time datetime="2021-12-04T04:14:11.000Z" itemprop="datePublished">2021-12-04</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%89%8D%E7%AB%AF%E8%BF%9B%E9%98%B6%E7%AC%94%E8%AE%B0/">前端进阶笔记</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h4 id="一、主题"><a href="#一、主题" class="headerlink" title="一、主题"></a>一、主题</h4><p>JS执行中的堆栈（浏览器平台下）<br>系统的梳理一些底层的知识</p>
<h4 id="二、XXX"><a href="#二、XXX" class="headerlink" title="二、XXX"></a>二、XXX</h4><p>基于代码的执行结果我们有必要对这些“简单代码的执行过程” 有一个深刻的理解。</p>
<ol>
<li>哪些平台可以执行 JS 代码：</li>
</ol>
<ul>
<li>浏览器平台 </li>
<li>NodejS </li>
<li>webview </li>
</ul>
<ol start="2">
<li>无论 JS 代码在哪些个平台上执行，最终都需要有一个执行的地方</li>
</ol>
<ul>
<li>代码最终都是运行在内存当中的</li>
<li>在 JS 执行过的过程中我们认为浏览器加载界面的时候就会向计算机的内存申请一片空间，用于执行 JS 代码</li>
<li>这个空间我们称之为叫 执行环境栈（ ECS execution context stack ）</li>
</ul>
<ol start="3">
<li>常见的名词 </li>
</ol>
<ul>
<li><p>执行环境栈：本质就是一个内存空间</p>
</li>
<li><p>执行上下文：( EC(execution context) )</p>
<ul>
<li>一段JS 代码里肯定会有很多内容：变量的声明、函数的定义、对象、块作用域</li>
<li>上述这些区域内都有自己的代码，默认情况下他们里面的内容可能会出现重名</li>
<li>所以代码将来在执行时候不可能直接放在一个“环境”下去运行，我们需要将它们隔离开</li>
<li>JS当中就有了执行上下文的概念，专门用于将不同区域的代码 “分开” 【  】</li>
<li>它也是一个内存空间，我们无须将它具像化。在它里面存放了当前区域代码运行时所需要的数据</li>
</ul>
</li>
<li><p>进栈执行</p>
<ul>
<li>执行环境栈具有先进后出的特点（）</li>
<li>每当“一段”代码要运行的时候，就会生成一个新的执行上下文，然后在这个上下文当中将执行时需要的内容准备好，之后就开始进栈执行 </li>
</ul>
</li>
<li><p>EC(G) （execution context global）</p>
<ul>
<li>全局执行上下文， 浏览器加载界面的时候就默认创建的一个环境 [这个上下文和我们代码执行与否没关系]</li>
<li>当前这个上下文如果想要出栈必然是界面关闭【 垃圾回收 】</li>
</ul>
</li>
<li><p>VO(G) variable object global） </p>
<ul>
<li>全局变量对象（ 全局执行上下文当中的变量需要有一个地方来存放，因此就有了这个对象 ）</li>
<li>每一段代码中都有声明和定义，他们放在哪？</li>
<li>针对全局执行上下文来说，它里面的声明和定义放在了一个对象当中，这个对象我们叫 VO(G)</li>
</ul>
</li>
<li><p>GO( global object ) </p>
<ul>
<li>全局对象， 它和 VO(G) 不是同一个东西 【 window 】</li>
<li>它也是浏览器加载界面时就会创建的一个对象，在它内部存放了许多JS默认就可以调用的属性和方法（ setTimeout setInterval JSON eval….. ）</li>
</ul>
</li>
<li><p>声明和定义 </p>
<ul>
<li>声明： var obj; </li>
<li>定义： obj = XXXX </li>
</ul>
</li>
</ul>
<h4 id="三、堆栈中的基本值"><a href="#三、堆栈中的基本值" class="headerlink" title="三、堆栈中的基本值"></a>三、堆栈中的基本值</h4><ul>
<li>在EC(G) 当中有 VO(G) 用来存储当前执行上下文里的变量声明和定义 </li>
<li>代码执行之前会有提升操作：对于 var 操作来说只声明不定义【重要】</li>
<li>基本数据类型值是直接存放在栈区当中的 </li>
<li>VO(G) 当中默认就有一个window 它存放的是一个内存地址，指向 GO 对象所在内存 </li>
</ul>
<h4 id="四、堆栈中的引用类型"><a href="#四、堆栈中的引用类型" class="headerlink" title="四、堆栈中的引用类型"></a>四、堆栈中的引用类型</h4><ol>
<li>引用类型在 JS 中会单独开辟一个空间进行存储（堆区）</li>
<li>堆区本质上也是一个内存，因此会有一个16进制的地址 </li>
<li>在栈区当中存放的是这个内存的16进制地址</li>
</ol>
<h4 id="五、函数在堆栈中的存储"><a href="#五、函数在堆栈中的存储" class="headerlink" title="五、函数在堆栈中的存储"></a>五、函数在堆栈中的存储</h4><ul>
<li>函数的创建<ul>
<li>创建函数和声明变量类似，可以将函数名看做是变量名</li>
<li>函数的提升与变量不同，它是既声明又定义（ 函数可以在定义之前调用 ）</li>
<li>函数创建时就会确认自己的作用域（就是当前所在执行上下文）</li>
</ul>
</li>
<li>函数执行  <ul>
<li>执行目的就是为了将函数创建时所保存的那些字符串形式的代码运行起来</li>
<li>代码运行时为了和其它上下文做隔离，因此每个函数执行时都会创建一个全新的私有上下文</li>
<li>在这个私有上下文当中有一个 AO(xxx) 用来存储函数上下文里的变量声明和定义 </li>
<li>执行步骤<ul>
<li>确定作用域链＜当前执行上下文，函数作用域＞</li>
<li>确定this 指向</li>
<li>初始化 arguments</li>
<li>形参赋值： 这里定义的变量都是当前函数上下文私有的</li>
<li>变量提升 </li>
<li>代码执行  </li>
</ul>
</li>
<li></li>
</ul>
</li>
</ul>
<h4 id="六、闭包"><a href="#六、闭包" class="headerlink" title="六、闭包"></a>六、闭包</h4><p>闭包是一种机制，代码是具体表现，例如我们常见 大函数套小函数然后再返回小函数  </p>
<h4 id="写在最后"><a href="#写在最后" class="headerlink" title="写在最后"></a>写在最后</h4><p>原创博文, 如有错误, 敬请指导!</p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/eventloop/" rel="tag">eventloop</a></li></ul>

    </footer>
  </div>

    
 
    
</article>

    
    <article
  id="post-es6NewFeatures"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2021/11/28/es6NewFeatures/"
    >ECMAScript新特性</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2021/11/28/es6NewFeatures/" class="article-date">
  <time datetime="2021-11-28T03:58:46.000Z" itemprop="datePublished">2021-11-28</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%89%8D%E7%AB%AF%E8%BF%9B%E9%98%B6%E7%AC%94%E8%AE%B0/">前端进阶笔记</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h4 id="ECMAScript与JavaScript"><a href="#ECMAScript与JavaScript" class="headerlink" title="ECMAScript与JavaScript"></a>ECMAScript与JavaScript</h4><h5 id="ES概述"><a href="#ES概述" class="headerlink" title="ES概述"></a>ES概述</h5><p>ECMAScript 6（简称ES6）是于2015年6月正式发布的JavaScript语言的标准，正式名为ECMAScript 2015（ES2015）。它的目标是使得JavaScript语言可以用来编写复杂的大型应用程序，成为企业级开发语言。<br>另外，一些情况下ES6也泛指ES2015及之后的新增特性，虽然之后的版本应当称为ES7、ES8等。</p>
<p>JavaScript是ECMAScript的扩展语言, JS的语言本身就是ES, ES只提供最基本的语法, ES6更新的内容很多, 需要我们一点点的去了解.</p>
<p>比如新增let块级作用域, const 常量声明, es6以后 尽量不适用var声明变量.</p>
<h4 id="es的一些新特性的简单介绍"><a href="#es的一些新特性的简单介绍" class="headerlink" title="es的一些新特性的简单介绍"></a>es的一些新特性的简单介绍</h4><h5 id="解构"><a href="#解构" class="headerlink" title="解构"></a>解构</h5><p>ES6的解构说白了就是能够让我们一次性取到多个值</p>
<p><strong>数组的解构</strong></p>
<p>普通的一维数组解构如下</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> object = [<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>]</span><br><span class="line"><span class="keyword">let</span> [aa, bb] = object</span><br></pre></td></tr></table></figure>
<p>可以跳着元素解构</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> [,,three] = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>];</span><br><span class="line"><span class="comment">// three=3</span></span><br></pre></td></tr></table></figure>
<p>可以使用…来获取后面所有的值</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> [one,...three] = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>];</span><br><span class="line"><span class="comment">// three=[2,3];</span></span><br></pre></td></tr></table></figure>
<p>当访问空数组或则越界的时候会得到undefined；</p>
<p><strong>对象的解构</strong></p>
<p>对象解构使用{}，首先指定要解构的属性名，然后指定绑定的变量</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> &#123;<span class="attr">name</span>:nameA,<span class="attr">age</span>:ageA&#125;=&#123;<span class="attr">name</span>:<span class="string">&quot;Jhon&quot;</span>,<span class="attr">age</span>:<span class="number">23</span>&#125;;</span><br><span class="line"><span class="comment">// nameA=&quot;Jhon&quot;,ageA=23</span></span><br></pre></td></tr></table></figure>
<p>如果属性名和变量名一致时，可以缩写</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> object = &#123;</span><br><span class="line">    <span class="attr">a</span>: <span class="string">&#x27;aaa&#x27;</span>,</span><br><span class="line">    <span class="attr">b</span>: <span class="string">&#x27;bbb&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> &#123;a, b&#125; = object</span><br></pre></td></tr></table></figure>
<p>如果在花括号里的变量名与所要对应的对象里的属性名不相同，则该变量的返回值是undefined。如：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> object = &#123;</span><br><span class="line">    <span class="attr">a</span>: <span class="string">&#x27;aaa&#x27;</span>,</span><br><span class="line">    <span class="attr">b</span>: <span class="string">&#x27;bbb&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> &#123;a, c&#125; = object  <span class="comment">//c变量的返回值为undefined</span></span><br></pre></td></tr></table></figure>


<h5 id="模板字符串"><a href="#模板字符串" class="headerlink" title="模板字符串"></a>模板字符串</h5><p>模板字符串在使用时应用反引号包裹字符串, 模板字符串简化了字符串的拼接并支持直接/n换行,  支持插值表达式如:${name}, 模板字符串会自动执行js表达式的结果,并拼接到最终生成的普通字符串中.<br>需要定义标签函数: 在字符串前可以加一个标签，标签实际就是一个函数，添加标签即为调用这个函数。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> result = myTagFunc<span class="string">`hey, <span class="subst">$&#123;name&#125;</span> is a <span class="subst">$&#123;gender&#125;</span>.`</span></span><br><span class="line"><span class="built_in">console</span>.log(result)</span><br></pre></td></tr></table></figure>


<h5 id="字符串的扩展方法"><a href="#字符串的扩展方法" class="headerlink" title="字符串的扩展方法"></a>字符串的扩展方法</h5><p>在ES6中还提供了三个处理字符串的新方法，分别是includes(),startsWith(),endsWith()，见名知意</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> message = <span class="string">&#x27;Error: foo is not defined.&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(</span><br><span class="line">  message.startsWith(<span class="string">&#x27;Error&#x27;</span>)   <span class="comment">//是否以xx开头</span></span><br><span class="line">  message.endsWith(<span class="string">&#x27;.&#x27;</span>)    <span class="comment">//是否以xx结尾</span></span><br><span class="line">  message.includes(<span class="string">&#x27;foo&#x27;</span>)  <span class="comment">//是否包含xx</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h5 id="参数默认值"><a href="#参数默认值" class="headerlink" title="参数默认值"></a>参数默认值</h5><p>短路运算很多情况下是不适合判断默认参数的，例如 0 ‘’ false null</p>
<p>所以如果有多个形参, 参数默认值要放在最后</p>
<h5 id="剩余参数"><a href="#剩余参数" class="headerlink" title="剩余参数"></a>剩余参数</h5><p>…args, 只能放在最后一位, 并且只能使用一次</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span> (<span class="params">first, ...args</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(args)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">foo(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>)  <span class="comment">//[2, 3, 4]</span></span><br></pre></td></tr></table></figure>

<h5 id="展开数组"><a href="#展开数组" class="headerlink" title="展开数组"></a>展开数组</h5><p>往常我们展开数组是使用apply函数, es6新特性出来后, 我们使用…方法展开数组, </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> arr = [<span class="string">&#x27;foo&#x27;</span>, <span class="string">&#x27;bar&#x27;</span>, <span class="string">&#x27;baz&#x27;</span>]</span><br><span class="line"><span class="keyword">const</span> arr1 = [<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">// console.log.apply(console, arr)</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(arr.push(...arr))</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>…arr会展开数组按照次序传入</p>
<h5 id="箭头函数"><a href="#箭头函数" class="headerlink" title="箭头函数"></a>箭头函数</h5><p>箭头函数用 =&gt; 符号来定义。</p>
<p>箭头函数相当于匿名函数，所以采用函数表达式的写法。</p>
<p>左边是传入函数的参数，右边是函数中执行的语句。</p>
<p>如:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> sum = <span class="function">(<span class="params">x, y</span>) =&gt;</span> x + y</span><br></pre></td></tr></table></figure>

<p>箭头函数的好处是:</p>
<ul>
<li>更简短易读</li>
<li>没有this的机制，不会改变this的指向</li>
<li>可以避免函数内_this的出现</li>
</ul>
<p>此处推荐firecode插件, 可以使 ‘===’ 或 ‘=&gt;’ 等符号显示的更易读</p>
<h5 id="对象字面量"><a href="#对象字面量" class="headerlink" title="对象字面量"></a>对象字面量</h5><p>变量属性名一样的情况下，变量可以省略<br>给对象添加方法，可以省略function，可以直接方法名（）：{ }<br>可以使用[表达式的返回值]作为对象的属性名</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">  <span class="attr">foo</span>: <span class="number">123</span>,</span><br><span class="line">  <span class="comment">// bar: bar</span></span><br><span class="line">  <span class="comment">// 属性名与变量名相同，可以省略 : bar</span></span><br><span class="line">  bar,</span><br><span class="line">  <span class="comment">// method1: function () &#123;</span></span><br><span class="line">  <span class="comment">//   console.log(&#x27;method111&#x27;)</span></span><br><span class="line">  <span class="comment">// &#125;</span></span><br><span class="line">  <span class="comment">// 方法可以省略 : function</span></span><br><span class="line">  method1 () &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;method111&#x27;</span>)</span><br><span class="line">    <span class="comment">// 这种方法就是普通的函数，同样影响 this 指向。</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">this</span>)</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// Math.random(): 123 // 不允许</span></span><br><span class="line">  <span class="comment">// 通过 [] 让表达式的结果作为属性名</span></span><br><span class="line">  [bar]: <span class="number">123</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>内部的this会指向当前对象</p>
<h5 id="对象扩展方法"><a href="#对象扩展方法" class="headerlink" title="对象扩展方法"></a>对象扩展方法</h5><p>assign方法<br>object.assign(target, source)<br>将多个源对象(source)中的属性复制到一个目标对象(target)，（如果有就覆盖，没有就添加）<br>用途：Object.assign({}, obj)  (变成新对象就可以修改了)<br>如:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">func</span> (<span class="params">obj</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// obj.name = &#x27;func obj&#x27;</span></span><br><span class="line">  <span class="comment">// console.log(obj)</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> funcObj = <span class="built_in">Object</span>.assign(&#123;&#125;, obj)</span><br><span class="line">  funcObj.name = <span class="string">&#x27;func obj&#x27;</span></span><br><span class="line">  <span class="built_in">console</span>.log(funcObj)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> obj = &#123; <span class="attr">name</span>: <span class="string">&#x27;global obj&#x27;</span> &#125;</span><br><span class="line"></span><br><span class="line">func(obj)</span><br><span class="line"><span class="built_in">console</span>.log(obj)</span><br></pre></td></tr></table></figure>

<h5 id="is方法"><a href="#is方法" class="headerlink" title="is方法"></a>is方法</h5><p>三等号不能判断 +0 和 -0<br>NaN不三等NaN<br>但使用object.is判断上面俩个例子可以是true </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(</span><br><span class="line">  <span class="comment">// 0 == false              // =&gt; true</span></span><br><span class="line">  <span class="comment">// 0 === false             // =&gt; false</span></span><br><span class="line">  <span class="comment">// +0 === -0               // =&gt; true</span></span><br><span class="line">  <span class="comment">// NaN === NaN             // =&gt; false</span></span><br><span class="line">  <span class="comment">// Object.is(+0, -0)       // =&gt; false</span></span><br><span class="line">  <span class="comment">// Object.is(NaN, NaN)     // =&gt; true</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h5 id="proxy代理"><a href="#proxy代理" class="headerlink" title="proxy代理"></a>proxy代理</h5><p>//Object.defineProperty只能监视读写</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> personProxy = <span class="keyword">new</span> <span class="built_in">Proxy</span>( person【代理对象】，&#123;</span><br><span class="line">set<span class="comment">//设置对象</span></span><br><span class="line">get<span class="comment">//监视访问【返回值是外部访问这个属性得到的结果】</span></span><br><span class="line">&#125;<span class="comment">//【代理处理对象】</span></span><br></pre></td></tr></table></figure>
<p><img src="/2021/11/28/es6NewFeatures/1622190711615.jpg"></p>
<p>对数组更好的监视<br>Proxy是以非侵入的方式监管了对象的读写</p>
<h5 id="Reflect-13个方法"><a href="#Reflect-13个方法" class="headerlink" title="Reflect 13个方法"></a>Reflect 13个方法</h5><p>搭配proxy的13个方法使用<br>统一提供一套用于操作对象的API<br>了解13个方法以及取代的用法</p>
<h5 id="promise"><a href="#promise" class="headerlink" title="promise"></a>promise</h5><p>promise是一种更优的异步编程解决方案<br>解决了传统异步编程中回调函数嵌套过深的问题<br>其他博文有写, 这里不过多说明</p>
<h5 id="class类"><a href="#class类" class="headerlink" title="class类"></a>class类</h5><p>一个简单的类</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">  <span class="title">constructor</span> (<span class="params">name</span>) &#123;</span><br><span class="line">    <span class="built_in">this</span>.name = name</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  say () &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`hi, my name is <span class="subst">$&#123;<span class="built_in">this</span>.name&#125;</span>`</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> p = <span class="keyword">new</span> Person(<span class="string">&#x27;tom&#x27;</span>)</span><br><span class="line">p.say()</span><br></pre></td></tr></table></figure>
<p>理解实例方法vs静态方法</p>
<h5 id="类的继承"><a href="#类的继承" class="headerlink" title="类的继承"></a>类的继承</h5><p>extends<br>super始终指向父类，调用super（）就是调用了父类的构造函数<br>接上面类一部分的例子</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span> <span class="keyword">extends</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">  <span class="title">constructor</span> (<span class="params">name, number</span>) &#123;</span><br><span class="line">    <span class="built_in">super</span>(name) <span class="comment">// 父类构造函数</span></span><br><span class="line">    <span class="built_in">this</span>.number = number</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  hello () &#123;</span><br><span class="line">    <span class="built_in">super</span>.say() <span class="comment">// 调用父类成员</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`my school number is <span class="subst">$&#123;<span class="built_in">this</span>.number&#125;</span>`</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> s = <span class="keyword">new</span> Student(<span class="string">&#x27;jack&#x27;</span>, <span class="string">&#x27;100&#x27;</span>)</span><br><span class="line">s.hello()</span><br></pre></td></tr></table></figure>

<h5 id="set数据结构"><a href="#set数据结构" class="headerlink" title="set数据结构"></a>set数据结构</h5><p>set数据结构类似数组, 常用方法有:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//内部成员不可重复</span></span><br><span class="line"><span class="keyword">const</span> s = <span class="keyword">new</span> <span class="built_in">Set</span>()</span><br><span class="line">s.add(<span class="number">1</span>).add(<span class="number">2</span>)</span><br><span class="line">s.forEach()</span><br><span class="line">s.size</span><br><span class="line">s.has(<span class="number">100</span>)</span><br><span class="line">s.delete(<span class="number">3</span>)</span><br><span class="line">s.clear()</span><br><span class="line"></span><br><span class="line"><span class="comment">//常见的是数组去重</span></span><br><span class="line"><span class="keyword">const</span> result = <span class="built_in">Array</span> .from(<span class="keyword">new</span> <span class="built_in">Set</span>(arr)）</span><br><span class="line"><span class="keyword">const</span> result = [...new <span class="built_in">Set</span>(arr)]</span><br><span class="line"></span><br><span class="line"><span class="comment">// 弱引用版本是 WeakSet</span></span><br><span class="line"><span class="comment">// 差异就是 Set 中会对所使用到的数据产生引用</span></span><br><span class="line"><span class="comment">// 即便这个数据在外面被消耗，但是由于 Set 引用了这个数据，所以依然不会回收</span></span><br><span class="line"><span class="comment">// 而 WeakSet 的特点就是不会产生引用，</span></span><br><span class="line"><span class="comment">// 一旦数据销毁，就可以被回收，所以不会产生内存泄漏问题。</span></span><br></pre></td></tr></table></figure>

<h5 id="map数据结构"><a href="#map数据结构" class="headerlink" title="map数据结构"></a>map数据结构</h5><p>map数据结构类似对象, 但对象的键只能是字符串, map可以是任意两个数据的映射<br>常用方法有:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">map.has(<span class="number">100</span>)</span><br><span class="line">map.delete(<span class="number">3</span>)</span><br><span class="line">map.clear()</span><br><span class="line">map.forEach()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 弱引用版本 WeakMap</span></span><br><span class="line"><span class="comment">// 差异就是 Map 中会对所使用到的数据产生引用</span></span><br><span class="line"><span class="comment">// 即便这个数据在外面被消耗，但是由于 Map 引用了这个数据，所以依然不会回收</span></span><br><span class="line"><span class="comment">// 而 WeakMap 的特点就是不会产生引用，</span></span><br><span class="line"><span class="comment">// 一旦数据销毁，就可以被回收，所以不会产生内存泄漏问题。</span></span><br></pre></td></tr></table></figure>

<h5 id="symbol"><a href="#symbol" class="headerlink" title="symbol"></a>symbol</h5><p>symbol是一种全新的原始数据类型, 最主要的作用就是为对象添加独一无二的属性名</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> s = <span class="built_in">Symbol</span>()</span><br><span class="line"><span class="built_in">Symbol</span>() === <span class="built_in">Symbol</span>()是<span class="literal">false</span></span><br></pre></td></tr></table></figure>
<p>对象的键可以是symbol, 因为symbol的唯一性, for in 和keys拿不到, 特别作为适合私有属性名<br>(object.getOwnPropertySymbols(obj)可以拿到但只能拿到symbol()类型<br>6种基本数据类型+symbol就是7种类型+下一版本的bugInt就是8种数据类型</p>
<h5 id="for-of"><a href="#for-of" class="headerlink" title="for of"></a>for of</h5><p>for of可以遍历任何一种数据结构<br>普通对象因为没有迭代接口所以不能被直接 for…of 遍历<br>for of可以使用break终止循环, 而foreach不能终止</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> arr = [<span class="number">100</span>, <span class="number">200</span>, <span class="number">300</span>, <span class="number">400</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> item <span class="keyword">of</span> arr) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(item)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="可迭代接口-iterable"><a href="#可迭代接口-iterable" class="headerlink" title="可迭代接口 iterable"></a>可迭代接口 iterable</h5><p>数据实现iterable接口才能使用for of来循环<br>实现一个可迭代接口:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">  <span class="attr">store</span>: [<span class="string">&#x27;foo&#x27;</span>, <span class="string">&#x27;bar&#x27;</span>, <span class="string">&#x27;baz&#x27;</span>],</span><br><span class="line"></span><br><span class="line">  [<span class="built_in">Symbol</span>.iterator]: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> index = <span class="number">0</span></span><br><span class="line">    <span class="keyword">const</span> self = <span class="built_in">this</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="attr">next</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">const</span> result = &#123;</span><br><span class="line">          <span class="attr">value</span>: self.store[index],</span><br><span class="line">          <span class="attr">done</span>: index &gt;= self.store.length</span><br><span class="line">        &#125;</span><br><span class="line">        index++</span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> item <span class="keyword">of</span> obj) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;循环体&#x27;</span>, item)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>迭代器适用于任何数据类型</p>
<h5 id="生成器"><a href="#生成器" class="headerlink" title="生成器"></a>生成器</h5><p>生成器可以减少异步回调嵌套过深产生的问题<br>定义生成器, 就是在函数名前面加个*:  function * foo(){}<br>会返回一个生成器对象Object[Generator]{}(也有迭代器接口), 调用next才会让函数体开始执行, 执行到yield暂停, yield的值作为生成器的结果(value)返回, 再yield再开始, .next()会返回格式类似{value:100, done: true}的返回值, 特点是惰性执行, 抽一下动一下, 可应用于发号器等功能</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> * <span class="title">foo</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;1111&#x27;</span>)</span><br><span class="line">  <span class="keyword">yield</span> <span class="number">100</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;2222&#x27;</span>)</span><br><span class="line">  <span class="keyword">yield</span> <span class="number">200</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;3333&#x27;</span>)</span><br><span class="line">  <span class="keyword">yield</span> <span class="number">300</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> generator = foo()</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(generator.next()) <span class="comment">// 第一次调用，函数体开始执行，遇到第一个 yield 暂停</span></span><br><span class="line"><span class="built_in">console</span>.log(generator.next()) <span class="comment">// 第二次调用，从暂停位置继续，直到遇到下一个 yield 再次暂停</span></span><br><span class="line"><span class="built_in">console</span>.log(generator.next()) <span class="comment">// 。。。</span></span><br><span class="line"><span class="built_in">console</span>.log(generator.next()) <span class="comment">// 第四次调用，已经没有需要执行的内容了，所以直接得到 undefined</span></span><br></pre></td></tr></table></figure>

<h5 id="ES-Modules"><a href="#ES-Modules" class="headerlink" title="ES Modules"></a>ES Modules</h5><p>ES Module把一个文件当作一个模块，每个模块有自己的独立作用域，那如何把每个模块联系起来呢？核心点就是模块的导入（import）与导出（export）。<br>在模块A中定义了一些变量与方法，然后将其导出。如果导入的多个文件中，变量名字相同，即会产生命名冲突的问题，为了解决该问题，ES6为提供了重命名的方法，当你在导入名称时可以使用as来重命名.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; name <span class="keyword">as</span> name1 &#125; <span class="keyword">from</span> <span class="string">&quot;xxx.js&quot;</span></span><br></pre></td></tr></table></figure>

<h5 id="es2016新功能概述"><a href="#es2016新功能概述" class="headerlink" title="es2016新功能概述"></a>es2016新功能概述</h5><p>仅包含两个小功能</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">arr.includes(indexOf不能查找<span class="literal">NaN</span>)</span><br></pre></td></tr></table></figure>
<p>指数运算符</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2</span> ** <span class="number">10</span> (=<span class="built_in">Math</span>.pow(<span class="number">2</span>,<span class="number">10</span>))</span><br></pre></td></tr></table></figure>

<h5 id="es2017新功能概述"><a href="#es2017新功能概述" class="headerlink" title="es2017新功能概述"></a>es2017新功能概述</h5><p>Object对象的三个方法</p>
<ul>
<li>obj.values(返回所有值的数组,相对于obj.keys())</li>
<li>obj.entries(以数组的形式返回所有的键值对) </li>
<li>obj.getOwnPropertyDescriptors<br>字符串对齐方法</li>
<li>String.prototype.padStart (16, ‘-‘)</li>
<li>String.prototype.padEnd(3. ‘0’)<br>在函数参数中添加尾逗号(很小的变化但很方便)<br>async/await语法</li>
</ul>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/es6/" rel="tag">es6</a></li></ul>

    </footer>
  </div>

    
 
    
</article>

    
    <article
  id="post-ybbc"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2021/11/20/ybbc/"
    >异步编程</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2021/11/20/ybbc/" class="article-date">
  <time datetime="2021-11-20T09:21:33.000Z" itemprop="datePublished">2021-11-20</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%89%8D%E7%AB%AF%E8%BF%9B%E9%98%B6%E7%AC%94%E8%AE%B0/">前端进阶笔记</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <p>概要：</p>
<ul>
<li>同步模式与异步模式</li>
<li>事件循环与消息队列</li>
<li>异步编程的几种方式</li>
<li>Promise异步方案、宏任务/微任务队列</li>
<li>Generator异步方案、Async / Await语法糖</li>
</ul>
<h4 id="什么是同步模式和异步模式"><a href="#什么是同步模式和异步模式" class="headerlink" title="什么是同步模式和异步模式"></a>什么是同步模式和异步模式</h4><p>同步函数：当一个函数是同步执行时，那么当该函数被调用时不会立即返回，直到该函数所要做的事情全都做完了才返回.调用栈（工作表）,消息循环(eventloop)，把全部代码放入匿名函数去执行, 如果某一功能执行时间过长，后面就会阻塞（卡死），所以需要异步函数.</p>
<p>异步函数：如果一个异步函数被调用时，该函数会立即返回尽管该函数规定的操作任务还没有完成.含有异步函数的代码的执行顺序会混乱, 代码不会等待程序执行完, 同步函数执行完了才会去执行异步函数.</p>
<p>异步函数h调用时，调用方不等被调方返回结果就转身离去，因此必须有一种机制让被调方有了结果时能通知调用方.在同一进程中有很多手段可以利用，常用的手段是回调、event 对象和消息.</p>
<p>回调方式很简单：调用异步函数时在参数中放入一个函数地址，异步函数保存此地址，待有了结果后回调此函数便可以向调用方发出通知.如果把异步函数包装进一个对象中，可以用事件取代回调函数地址，通过事件处理例程向调用方发通知.</p>
<p>回调函数是所有异步编程方案的根基，但大量嵌套回调不可取(回调地狱).</p>
<blockquote>
<p>小tips: 使用setTimeout 0 可以把同步代码变为异步代码</p>
</blockquote>
<h4 id="promise"><a href="#promise" class="headerlink" title="promise"></a>promise</h4><p>promise的几个特点</p>
<ul>
<li>promise是一个对象，对象和函数的区别就是对象可以保存状态，函数不可以（闭包除外）.</li>
<li>并未剥夺函数return的能力，因此无需层层传递callback，进行回调获取数据.</li>
<li>代码风格，容易理解，便于维护.</li>
<li>多个异步等待合并便于解决.</li>
</ul>
<h5 id="一个最最简单的promise"><a href="#一个最最简单的promise" class="headerlink" title="一个最最简单的promise"></a>一个最最简单的promise</h5><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    resolve(<span class="string">&#x27;hello&#x27;</span>)</span><br><span class="line">  &#125;, <span class="number">2000</span>)&#125;).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(res)&#125;)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>promise的使用案例(基本应用)</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//使用promise实现ajax</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ajax</span> (<span class="params">url</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest()</span><br><span class="line">    xhr.open(<span class="string">&#x27;GET&#x27;</span>, url)</span><br><span class="line">    xhr.responseType = <span class="string">&#x27;json&#x27;</span></span><br><span class="line">    xhr.onload = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">this</span>.status === <span class="number">200</span>) &#123;</span><br><span class="line">        resolve(<span class="built_in">this</span>.response)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        reject(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="built_in">this</span>.statusText))</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    xhr.send()</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ajax(<span class="string">&#x27;/api/foo.json&#x27;</span>).then(<span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(res)</span><br><span class="line">&#125;, <span class="function"><span class="keyword">function</span> (<span class="params">error</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(error)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>


<h5 id="promise有三个状态：pending-fulfilled-rejected"><a href="#promise有三个状态：pending-fulfilled-rejected" class="headerlink" title="promise有三个状态：pending, fulfilled, rejected."></a>promise有三个状态：pending, fulfilled, rejected.</h5><p>promise状态一经改变，就不会再改变了.且状态改变只有两种可能：</p>
<ul>
<li>从pending变为fulfilled</li>
<li>从pending变为rejected.</li>
</ul>
<p>这两种情况只要发生，状态就凝固了，不会再变了.</p>
<p>当promise状态发生改变，就会触发then()里的响应函数处理后续步骤；</p>
<p>promise.then()方法有两个参数, resolve和reject.</p>
<p>resolve作用是，将Promise对象的状态从“未完成”变为“成功”（即从 pending 变为 resolved），在异步操作成功时调用，并将异步操作的结果，作为参数传递出去；<br>reject作用是，将Promise对象的状态从“未完成”变为“失败”（即从 pending 变为 rejected），在异步操作失败时调用，并将异步操作报出的错误，作为参数传递出去.</p>
<h5 id="链式调用"><a href="#链式调用" class="headerlink" title="链式调用"></a>链式调用</h5><p>promise在使用中要避免回调嵌套，尽量保持扁平化.</p>
<ul>
<li>Promise对象的then方法会返回一个全新的 Promise对象</li>
<li>后面的then方法就是在为上一个then返回的 Promise注册回调</li>
<li>前面then方法中回调函数的返回值会作为后面then方法回调的参数</li>
<li>如果回调中返回的是 Promise，那后面then方法的回调会等待它的结束</li>
</ul>
<p><strong>.then()</strong><br>1、接收两个函数作为参数，分别代表fulfilled（成功）和rejected（失败）<br>2、.then()返回一个新的Promise实例，所以它可以链式调用<br>3、当前面的Promise状态改变时，.then()根据其最终状态，选择特定的状态响应函数执行<br>4、状态响应函数可以返回新的promise，或其他值，不返回值也可以我们可以认为它返回了一个null；<br>5、如果返回新的promise，那么下一级.then()会在新的promise状态改变之后执行<br>6、如果返回其他任何值，则会立即执行下一级.then()<br>7、.then()里面的实参应该是函数.如果不是函数,就无视它’</p>
<blockquote>
<p>.then()里面有.then()的情况</p>
<ul>
<li>因为.then()返回的还是Promise实例</li>
<li>会等里面的then()执行完，再执行外面的</li>
<li>对于我们来说，此时最好将其展开，也是一样的结果，而且会更好读</li>
</ul>
</blockquote>
<h5 id="异常处理"><a href="#异常处理" class="headerlink" title="异常处理"></a>异常处理</h5><p>Promise会自动捕获内部异常，并交给rejected响应函数处理.</p>
<p>第一种：reject(‘错误信息’).then(() =&gt; {}, () =&gt; {错误处理逻辑})<br>第二种：throw new Error(‘错误信息’).catch( () =&gt; {错误处理逻辑})<br>推荐使用第二种方式，更加清晰好读，并且可以捕获前面所有的错误（可以捕获N个then回调错误）<br>.then onFulfilled<br>.catch onRejected<br>应该在代码中明确捕获每一个可能存在的异常 而不是丢给全局去处理</p>
<h5 id="并行执行"><a href="#并行执行" class="headerlink" title="并行执行"></a>并行执行</h5><blockquote>
<p>.all()</p>
</blockquote>
<p>Promise.all 方法接受一个数组作为参数，p1、p2、p3 都是 Promise 对象的实例.（Promise.all 方法的参数不一定是数组，但是必须具有 iterator 接口，且返回的每个成员都是 Promise 实例.）</p>
<p>.all()的状态分成两种情况.</p>
<ul>
<li>只有p1、p2/p3的状态都变成fulfilled，p的状态才会变成fulfilled，此时入参的返回值组成一个数组，传递给p的回调函数.</li>
<li>只要p1、p2/p3之中有一个被rejected，p的状态就变成rejected，此时第一个被reject的实例的返回值，会传递给p的回调函数.</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> p1 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  resolve(<span class="string">&#x27;成功了&#x27;</span>)&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> p2 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  resolve(<span class="string">&#x27;success&#x27;</span>)&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> p3 = Promse.reject(<span class="string">&#x27;失败&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">Promise</span>.all([p1, p2]).then(<span class="function">(<span class="params">result</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(result)     </span><br><span class="line">  &#125;).catch(<span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(error)</span><br><span class="line">  &#125;)          </span><br><span class="line">  <span class="comment">//[&#x27;成功了&#x27;, &#x27;success&#x27;]</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">Promise</span>.all([p1,p3,p2]).then(<span class="function">(<span class="params">result</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(result)</span><br><span class="line">  &#125;).catch(<span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(error)   </span><br><span class="line">  &#125;)   </span><br><span class="line">  <span class="comment">// 失败了，打出 &#x27;失败&#x27;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>.race()</p>
</blockquote>
<p>.race()只要有一个promise对象进入 FulFilled 或者 Rejected 状态的话，就会继续进行后面的处理.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> p1 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        resolve(<span class="string">&#x27;p1&#x27;</span>)</span><br><span class="line">      &#125;，<span class="number">1000</span>)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> p2 = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">  resolve(<span class="string">&#x27;p2&#x27;</span>)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> p3 = Promse.reject(<span class="string">&#x27;失败&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">Promise</span>.race([p1, p2]).then(<span class="function">(<span class="params">result</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(result)     </span><br><span class="line">  &#125;).catch(<span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(error)</span><br><span class="line">  &#125;)          </span><br><span class="line">  <span class="comment">//p2跑的更快 打印p2</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">Promise</span>.race([p1,p3,p2]).then(<span class="function">(<span class="params">result</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(result)</span><br><span class="line">  &#125;).catch(<span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(error)   </span><br><span class="line">  &#125;)   </span><br><span class="line">  <span class="comment">// 失败了，打出 &#x27;失败&#x27;</span></span><br></pre></td></tr></table></figure>

<h5 id="静态方法"><a href="#静态方法" class="headerlink" title="静态方法"></a>静态方法</h5><blockquote>
<p>.resolve方法</p>
</blockquote>
<p>有时需要将现有对象转为Promise对象，Promise.resolve方法就起到这个作用.</p>
<p>此时我们测试.resolve()函数，如果传入一个promise则返回这个promise，运行结果为: p1</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">myPromise.resolve(p1()).then( <span class="function"><span class="params">res</span> =&gt;</span> <span class="built_in">console</span>.log(res))</span><br></pre></td></tr></table></figure>
<p>如果传入一个常量则返回一个promise包裹这个常量，运行结果为: 100</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">myPromise.resolve(<span class="number">100</span>).then( <span class="function"><span class="params">res</span> =&gt;</span> <span class="built_in">console</span>.log(res))</span><br></pre></td></tr></table></figure>

<h5 id="执行时序-宏任务vs微任务"><a href="#执行时序-宏任务vs微任务" class="headerlink" title="执行时序/宏任务vs微任务"></a>执行时序/宏任务vs微任务</h5><p>宏任务是由宿主发起的，而微任务由JavaScript自身发起。<br>在ES3以及以前的版本中，JavaScript本身没有发起异步请求的能力，也就没有微任务的存在。在ES5之后，JavaScript引入了Promise，这样，不需要浏览器，JavaScript引擎自身也能够发起异步任务了。<br>回调任务中的任务称为宏任务，要重新排队.<br>promise中的任务是微任务，可直接执行.（process.nextTick/MutationObserver也是微任务）<br>所以，总结一下，两者区别为：</p>
<table>
    <tr>
        <th></th>
        <th>宏任务（macrotask）</th>
        <th>微任务（microtask）</th>  
    </tr>
    <tr>
        <td>谁发起的</td>
        <td>宿主（Node、浏览器）</td>
        <td>JS引擎</td>
    </tr>
    <tr>
        <td rowspan="5">具体事件</td>
        <td>1. script (可以理解为外层同步代码)</td>
        <td>1. Promise</td>
    </tr>
    <tr>
        <td>2. setTimeout/setInterval</td>
        <td>2. MutaionObserver</td>
    </tr>
    <tr>
        <td>3. UI rendering/UI事件</td>
        <td>3. Object.observe（已废弃；Proxy 对象替代）</td>
    </tr>
    <tr>
        <td>4. postMessage，MessageChannel</td>
        <td>4. process.nextTick（Node.js）</td>
    </tr>
    <tr><td>5. setImmediate，I/O（Node.js）</td>
        <td></td>
    </tr>
    <tr>
        <td>谁先运行</td>
        <td>后运行</td>
        <td>先运行</td>
    </tr>
    <tr>
        <td>会触发新一轮Tick吗</td>
        <td>会</td>
        <td>不会</td>
    </tr>
</table>

<h4 id="Generator异步方案（es2015）"><a href="#Generator异步方案（es2015）" class="headerlink" title="Generator异步方案（es2015）"></a>Generator异步方案（es2015）</h4><blockquote>
<p>这部分我会在其他博文中详细写到.届时贴链接过来.</p>
</blockquote>
<p>生成器函数, 就是函数名前多个*<br>调用不会马上执行, 但会得到一个生成器对象<br>调用.next()时执行<br>执行到函数里yield那一行, 把yield的值作为对象中的value返回<br>再次调用.next()如果有参数会从yield继续执行, 参数作为yield的值<br>.throw（）会抛出异常  执行.catch<br>.done 布尔  是否结束生成器<br>扩展: co库</p>
<h4 id="async-await是生成器的语法糖"><a href="#async-await是生成器的语法糖" class="headerlink" title="async/await是生成器的语法糖"></a>async/await是生成器的语法糖</h4><blockquote>
<p>这部分我会在其他博文中详细写到.届时贴链接过来.</p>
</blockquote>
<p>是语言层面的异步编程标准.</p>
<h4 id="写在最后"><a href="#写在最后" class="headerlink" title="写在最后"></a>写在最后</h4><p>参考资料: <a target="_blank" rel="noopener" href="https://www.jianshu.com/p/bfc3e319a96b">https://www.jianshu.com/p/bfc3e319a96b</a></p>
<p>原创博文, 如有错误, 敬请指导!</p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Promise/" rel="tag">Promise</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%BC%82%E6%AD%A5%E7%BC%96%E7%A8%8B/" rel="tag">异步编程</a></li></ul>

    </footer>
  </div>

    
 
    
</article>

    
    <article
  id="post-csjsj"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2021/10/16/csjsj/"
    >前端工程化和实现一个脚手架</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2021/10/16/csjsj/" class="article-date">
  <time datetime="2021-10-16T02:31:18.000Z" itemprop="datePublished">2021-10-16</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%89%8D%E7%AB%AF%E8%BF%9B%E9%98%B6%E7%AC%94%E8%AE%B0/">前端进阶笔记</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h4 id="前端工程化"><a href="#前端工程化" class="headerlink" title="前端工程化"></a>前端工程化</h4><p>node是前端的工业革命<br>前端工程化是指遵循一定的标准和规范, 通过工具去提高效率降低成本的一种手段,<br>一切以提高效率、降低成本、质量保证为目的的手段都属于[工程化], 一切重复的工作都应该被自动化<br>工程化不等于某个工具, 工程化的核心应该是对项目整体的一种规划或者架构, 工具只是实现其的一种手段</p>
<blockquote>
<p>使用工程化的原因</p>
</blockquote>
<p>想要使用ES6+新特性, 但是兼容有问题<br>想要使用 Less / Sass/ PostCSS增强 CSS的编程性, 但是运行环境不能直接支持<br>想要使用模块化的方式提高项目的可维护性, 但运行环境不能直接支持<br>部署上线前需要手动压缩代码及资源文件, 部署过程需要手动上传代码到服务器<br>多人协作开发, 无法硬性统一大家的代码风格, 从仓库中pull回来的代码质量无法保证<br>部分功能开发时需要等待后端服务接口提前完成</p>
<blockquote>
<p>工程化可以解决的问题</p>
</blockquote>
<p>传统语言或语法的弊端<br>无法使用模块化/组件化<br>重复的机械式工作<br>代码风格统一、质量保证<br>依赖后端服务接口支持<br>整体依赖后端项目</p>
<blockquote>
<p>一些成熟的工程化集成</p>
</blockquote>
<p>create-react-app<br>vue-cli<br>angular-cli<br>gatsby-cli</p>
<h4 id="脚手架工具"><a href="#脚手架工具" class="headerlink" title="脚手架工具"></a>脚手架工具</h4><p>脚手架工具是帮我们自动创建基础文件的工具<br>脚手架的本质作用就是创建项目基础结构、提供项目规范和约定, 相同的组织结构, 相同的开发范式, 相同的模块依赖, 相同的工具配置, 相同的基础代码都应该被自动化创建</p>
<p><strong>内容概要:</strong></p>
<ul>
<li>脚手架的作用</li>
<li>常用的脚手架工具</li>
<li>通用脚手架工具剖析</li>
<li>开发一款脚手架</li>
</ul>
<p><strong>常用的脚手架工具</strong><br>根据信息创建对应的项目基础结构有create-react-app, vue-cli, angular-cli等<br>例如创建一个组件/模块所需要的文件就可以用到plop</p>
<h5 id="Yeoman"><a href="#Yeoman" class="headerlink" title="Yeoman"></a>Yeoman</h5><p>The web’s scaffolding tool for modern webapps<br>可以搭配不同的generator去创建任何类型项目, 可以使用其搭建自己的脚手架<br>缺点是过于通用, 不够专注</p>
<p><strong>基本使用</strong><br>先安装基础模块: node, npm 或 yarn, 以下举例中我们使用yarn</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">yarn <span class="built_in">global</span> add yo <span class="comment">//全局安装Yeoman</span></span><br><span class="line">yarn <span class="built_in">global</span> add generator-node <span class="comment">// 一个node模块</span></span><br><span class="line">mkdir my-<span class="built_in">module</span></span><br><span class="line">cd my-<span class="built_in">module</span></span><br><span class="line">yo node <span class="comment">//input something...</span></span><br></pre></td></tr></table></figure>
<p>执行yo node后的命令行如下(做个例子)</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">localhost:my-<span class="built_in">module</span> zxl$ yo node</span><br><span class="line">? ==========================================================================</span><br><span class="line">We<span class="string">&#x27;re constantly looking for ways to make yo better! </span></span><br><span class="line"><span class="string">May we anonymously report usage statistics to improve the tool over time? </span></span><br><span class="line"><span class="string">More info: https://github.com/yeoman/insight &amp; http://yeoman.io</span></span><br><span class="line"><span class="string">? Module Name my-module</span></span><br><span class="line"><span class="string">(node:77281) [DEP0066] DeprecationWarning: OutgoingMessage.prototype._headers is deprecated</span></span><br><span class="line"><span class="string">(Use `node --trace-deprecation ...` to show where the warning was created)</span></span><br><span class="line"><span class="string">? The name above already exists on npm, choose another? No</span></span><br><span class="line"><span class="string">? Description a test project</span></span><br><span class="line"><span class="string">? Project homepage url https://github.com/Levxn7/yoNodeTest</span></span><br><span class="line"><span class="string">? Author&#x27;</span>s Name zxl</span><br><span class="line">? Author<span class="string">&#x27;s Email levxn7@qq.com</span></span><br><span class="line"><span class="string">? Author&#x27;</span>s Homepage https:<span class="comment">//levxn7.github.io/</span></span><br><span class="line">? Package keywords (comma to split) <span class="built_in">module</span>,node</span><br><span class="line">? Send coverage reports to coveralls No</span><br><span class="line">? Enter Node versions (comma separated) </span><br><span class="line">? GitHub username or organization Levxn7</span><br><span class="line">? Which license <span class="keyword">do</span> you want to use? Apache <span class="number">2.0</span></span><br></pre></td></tr></table></figure>


<p><strong>sub generator</strong><br>不是所有generator都有子集生成器</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yo node:cli <span class="comment">//cli应用</span></span><br><span class="line">yarn link <span class="comment">//建立通道</span></span><br></pre></td></tr></table></figure>

<p><strong>yeoman常规使用步骤</strong><br>1.明确你的需求;<br>2.找到合适的 Generator;<br>3.全局范围安装找到的 Generator;<br>4.通过Yo运行对应的Generator;<br>5.通过命令行交互填写选项;<br>6.生成你所需要的项目结构;</p>
<h5 id="基于Yeoman搭建自己的脚手架"><a href="#基于Yeoman搭建自己的脚手架" class="headerlink" title="基于Yeoman搭建自己的脚手架"></a>基于Yeoman搭建自己的脚手架</h5><p><strong>1.创建一个Generator模块</strong><br>名称必须是generator-<name>格式</name></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mkdir generator-sample</span><br><span class="line">cd generator-sample</span><br><span class="line">yarn init <span class="comment">//创建package.json</span></span><br><span class="line">yarn add yeoman-generator <span class="comment">// 这个模块提供了生成器的一个基类, 这个基类当中提供了一些工具函数 让我们在使用时更加便捷</span></span><br></pre></td></tr></table></figure>
<p>使用vscode打开项目, 创建generators/app/index.js, 此文件作为Generator的核心入口, 需要导出一个继承自Yeoman Generator的类型<br>Yeoman Generator 在工作时会自动调用我们在此类型中定义的一些生命周期方法, 我们在这些方法中可以通过调用父类提供的一些工具方法实现一些功能, 例如文件写入</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Generator = <span class="built_in">require</span>(<span class="string">&#x27;yeoman-generator&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="class"><span class="keyword">class</span> <span class="keyword">extends</span> <span class="title">Generator</span> </span>&#123;</span><br><span class="line">  writing () &#123;</span><br><span class="line">    <span class="comment">// Yeoman 自动在生成文件阶段调用此方法</span></span><br><span class="line">    <span class="comment">// 我们这里尝试往项目目录中写入文件</span></span><br><span class="line">    <span class="built_in">this</span>.fs.write(</span><br><span class="line">      <span class="built_in">this</span>.destinationPath(<span class="string">&#x27;temp.txt&#x27;</span>),</span><br><span class="line">      <span class="built_in">Math</span>.random().toString()</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>yarn link发布</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">localhost:generator-sample zxl$ yarn link</span><br><span class="line">yarn link v1<span class="number">.22</span><span class="number">.10</span></span><br><span class="line">success Registered <span class="string">&quot;generator-sample&quot;</span>.</span><br><span class="line">info You can now run <span class="string">`yarn link &quot;generator-sample&quot;`</span> <span class="keyword">in</span> the projects where you want to use <span class="built_in">this</span> package and it will be used instead.</span><br><span class="line">✨  Done <span class="keyword">in</span> <span class="number">0.</span>03s.</span><br></pre></td></tr></table></figure>


<p><strong>2.新建一个项目</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir my-pro</span><br><span class="line">cd my-pro</span><br><span class="line">yo sample</span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">localhost:my-pro zxl$ yo sample</span><br><span class="line">   create temp.txt</span><br></pre></td></tr></table></figure>
<p><img src="/2021/10/16/csjsj/QQ20210604-114517@2x.png"><br>这就创建好了, 可以看到我们使用yo sample为新文件夹创建了一个txt文件并写入了一个随机数, 这就是最基本的yeoman的开发过程,<br>下面我们再给他加上一点东西</p>
<p><strong>3.根据模板创建文件</strong><br>相对于手动创建每一个文件, 模板的方式大大提高了效率<br>在app文件夹下新建templates/foo.txt</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Generator = <span class="built_in">require</span>(<span class="string">&#x27;yeoman-generator&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="class"><span class="keyword">class</span> <span class="keyword">extends</span> <span class="title">Generator</span> </span>&#123;</span><br><span class="line">  writing () &#123;</span><br><span class="line">    <span class="comment">// Yeoman 自动在生成文件阶段调用此方法</span></span><br><span class="line">    <span class="comment">// 通过模板方式写入文件到目标目录</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 模板文件路径</span></span><br><span class="line">    <span class="keyword">const</span> tmpl = <span class="built_in">this</span>.templatePath(<span class="string">&#x27;foo.txt&#x27;</span>)</span><br><span class="line">    <span class="comment">// 输出目标路径</span></span><br><span class="line">    <span class="keyword">const</span> output = <span class="built_in">this</span>.destinationPath(<span class="string">&#x27;foo.txt&#x27;</span>)</span><br><span class="line">    <span class="comment">// 模板数据上下文</span></span><br><span class="line">    <span class="keyword">const</span> context = &#123; <span class="attr">title</span>: <span class="string">&#x27;Hello zce~&#x27;</span>, <span class="attr">success</span>: <span class="literal">false</span> &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">this</span>.fs.copyTpl(tmpl, output, context)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在foo中使用&lt;%= title %&gt;模式来替换关键字, yo sample结果生成foo.txt 其中内容也被替换了context中的内容<br><img src="/2021/10/16/csjsj/QQ20210604-115410@2x.png"></p>
<p>下面我们使用prompting方法接受用户输入数据, 然后把获取的结果传入context</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Generator = <span class="built_in">require</span>(<span class="string">&#x27;yeoman-generator&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="class"><span class="keyword">class</span> <span class="keyword">extends</span> <span class="title">Generator</span> </span>&#123;</span><br><span class="line">  prompting () &#123;</span><br><span class="line">    <span class="comment">// Yeoman 在询问用户环节会自动调用此方法</span></span><br><span class="line">    <span class="comment">// 在此方法中可以调用父类的 prompt() 方法发出对用户的命令行询问</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.prompt([</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;input&#x27;</span>, <span class="comment">//用户输入方式</span></span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;name&#x27;</span>,  <span class="comment">//对应返回值的键</span></span><br><span class="line">        <span class="attr">message</span>: <span class="string">&#x27;Your project name&#x27;</span>, <span class="comment">//给用户的提示</span></span><br><span class="line">        <span class="attr">default</span>: <span class="built_in">this</span>.appname <span class="comment">// appname 为项目生成目录名称</span></span><br><span class="line">      &#125;</span><br><span class="line">    ])</span><br><span class="line">    .then(<span class="function"><span class="params">answers</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// answers =&gt; &#123; name: &#x27;user input value&#x27; &#125;</span></span><br><span class="line">      <span class="built_in">this</span>.answers = answers</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  writing () &#123;</span><br><span class="line">    <span class="comment">// // 通过模板方式写入文件到目标目录</span></span><br><span class="line">    <span class="comment">// 模板文件路径</span></span><br><span class="line">    <span class="keyword">const</span> tmpl = <span class="built_in">this</span>.templatePath(<span class="string">&#x27;foo.txt&#x27;</span>)</span><br><span class="line">    <span class="comment">// 输出目标路径</span></span><br><span class="line">    <span class="keyword">const</span> output = <span class="built_in">this</span>.destinationPath(<span class="string">&#x27;foo.txt&#x27;</span>)</span><br><span class="line">    <span class="comment">// 模板数据上下文</span></span><br><span class="line">    <span class="keyword">const</span> context = <span class="built_in">this</span>.answers <span class="comment">// 这里为用户输入结果</span></span><br><span class="line">    <span class="built_in">this</span>.fs.copyTpl(tmpl, output, context)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我在foo中只写了一句&lt;%= name %&gt;, yo sample 后产生结果如下<br><img src="/2021/10/16/csjsj/QQ20210604-120142@2x.png"></p>
<h5 id="vue-generator案例"><a href="#vue-generator案例" class="headerlink" title="vue generator案例"></a>vue generator案例</h5><p>具体操作步骤其实上面已经说完了, 先创建一个yeoman, 把项目目录粘贴到templates中, 替换标签值（name等）, 把文件名全放到writing中做循环, 然后运行yarn link, 就可以创建了, 参考代码如下:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Generator = <span class="built_in">require</span>(<span class="string">&#x27;yeoman-generator&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="class"><span class="keyword">class</span> <span class="keyword">extends</span> <span class="title">Generator</span> </span>&#123;</span><br><span class="line">  prompting () &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.prompt([</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;input&#x27;</span>,</span><br><span class="line">        <span class="attr">name</span>: <span class="string">&#x27;name&#x27;</span>,</span><br><span class="line">        <span class="attr">message</span>: <span class="string">&#x27;Your project name&#x27;</span>,</span><br><span class="line">        <span class="attr">default</span>: <span class="built_in">this</span>.appname</span><br><span class="line">      &#125;</span><br><span class="line">    ])</span><br><span class="line">    .then(<span class="function"><span class="params">answers</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.answers = answers</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  writing () &#123;</span><br><span class="line">    <span class="comment">// 把每一个文件都通过模板转换到目标路径</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> templates = [</span><br><span class="line">      <span class="string">&#x27;.browserslistrc&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;.editorconfig&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;.env.development&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;.env.production&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;.eslintrc.js&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;.gitignore&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;babel.config.js&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;package.json&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;postcss.config.js&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;README.md&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;public/favicon.ico&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;public/index.html&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;src/App.vue&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;src/main.js&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;src/router.js&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;src/assets/logo.png&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;src/components/HelloWorld.vue&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;src/store/actions.js&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;src/store/getters.js&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;src/store/index.js&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;src/store/mutations.js&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;src/store/state.js&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;src/utils/request.js&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;src/views/About.vue&#x27;</span>,</span><br><span class="line">      <span class="string">&#x27;src/views/Home.vue&#x27;</span></span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">    templates.forEach(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// item =&gt; 每个文件路径</span></span><br><span class="line">      <span class="built_in">this</span>.fs.copyTpl(</span><br><span class="line">        <span class="built_in">this</span>.templatePath(item),</span><br><span class="line">        <span class="built_in">this</span>.destinationPath(item),</span><br><span class="line">        <span class="built_in">this</span>.answers</span><br><span class="line">      )</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="发布generator"><a href="#发布generator" class="headerlink" title="发布generator"></a>发布generator</h5><p>将代码托管到git（.gitignore忽略node_modules） 对git命令行不熟悉的同学可以先学习一下git</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">git init</span><br><span class="line">git status</span><br><span class="line">git add</span><br><span class="line">git commit</span><br><span class="line">create一个github地址</span><br><span class="line">git remote add origin https:<span class="comment">//xxxx.git</span></span><br><span class="line">git push -u origin master</span><br><span class="line">yarn publish</span><br><span class="line">如果镜像有问题就yarn publish --registry=https:<span class="comment">//registry.yarnpkg.com</span></span><br></pre></td></tr></table></figure>

<h5 id="plop"><a href="#plop" class="headerlink" title="plop"></a>plop</h5><p>一个小而美的脚手架工具</p>
<p><strong>基本使用</strong></p>
<ul>
<li>将plop模块作为项目开发依赖安装  (yarn add plop –dev)</li>
<li>在项目根目录下创建一个plopfile.js文件</li>
<li>在plopfile.js文件中定义脚手架任务</li>
<li>编写用于生成特定类型文件的模板  (创建hbs模板)</li>
<li>通过Plop提供的CLI运行脚手架任务  (yarn plop component)</li>
</ul>
<h4 id="脚手架的工作原理"><a href="#脚手架的工作原理" class="headerlink" title="脚手架的工作原理"></a>脚手架的工作原理</h4><p>脚手架就是一个node-cli应用<br>通过 yarn init 创建一个package.json文件, 在里面添加一个bin字段,用来指定一下这个cli应用的入口文件cli.js, 这个入口文件必须要写一个特定的文件头 #!/usr/bin/env node , 如果是 Linux 或者 macOS 系统下还需要修改此文件的读写权限为 755, 具体就是通过 chmod 755 cli.js 实现修改</p>
<p>与用户交互需要安装 inquire 模块,  yarn add inquire//对用户发起命令行交互询问<br>然后引入模块</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/env node</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Node CLI 应用入口文件必须要有这样的文件头</span></span><br><span class="line"><span class="comment">// 如果是 Linux 或者 macOS 系统下还需要修改此文件的读写权限为 755</span></span><br><span class="line"><span class="comment">// 具体就是通过 chmod 755 cli.js 实现修改</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 脚手架的工作过程：</span></span><br><span class="line"><span class="comment">// 1. 通过命令行交互询问用户问题</span></span><br><span class="line"><span class="comment">// 2. 根据用户回答的结果生成文件</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> inquirer = <span class="built_in">require</span>(<span class="string">&#x27;inquirer&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> ejs = <span class="built_in">require</span>(<span class="string">&#x27;ejs&#x27;</span>)</span><br><span class="line"></span><br><span class="line">inquirer.prompt([ <span class="comment">//这个方法可以发起用户询问</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="string">&#x27;input&#x27;</span>,</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;name&#x27;</span>,</span><br><span class="line">    <span class="attr">message</span>: <span class="string">&#x27;Project name?&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">])</span><br><span class="line">.then(<span class="function"><span class="params">anwsers</span> =&gt;</span> &#123;  <span class="comment">//这个方法获取用户回答</span></span><br><span class="line">  <span class="comment">// console.log(anwsers)</span></span><br><span class="line">  <span class="comment">// 根据用户回答的结果生成文件</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//新建一个templates模板, 通过 &lt;%= name %&gt; 模式获取用户输入的值</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 模板目录</span></span><br><span class="line">  <span class="keyword">const</span> tmplDir = path.join(__dirname, <span class="string">&#x27;templates&#x27;</span>)</span><br><span class="line">  <span class="comment">// 目标目录 使用node方法拿到执行命令行的目录</span></span><br><span class="line">  <span class="keyword">const</span> destDir = process.cwd()</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 将模板下的文件全部转换到目标目录 这个方法自动扫描路径下的所有文件</span></span><br><span class="line">  fs.readdir(tmplDir, <span class="function">(<span class="params">err, files</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) <span class="keyword">throw</span> err</span><br><span class="line">    files.forEach(<span class="function"><span class="params">file</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">//拿到的file是相对路径</span></span><br><span class="line">      <span class="comment">// 通过模板引擎渲染文件 安装一个ejs的模板引擎 通过ejs.renderFile去渲染这个目录对应的文件</span></span><br><span class="line">      ejs.renderFile(path.join(tmplDir, file), anwsers, <span class="function">(<span class="params">err, result</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (err) <span class="keyword">throw</span> err</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 将结果写入目标文件路径</span></span><br><span class="line">        fs.writeFileSync(path.join(destDir, file), result)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>脚手架的原理虽然并不复杂, 但是他的意义是很大的, 他在项目创建环节大大提高了效率</p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Yeoman/" rel="tag">Yeoman</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%89%8D%E7%AB%AF%E5%B7%A5%E7%A8%8B%E5%8C%96/" rel="tag">前端工程化</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E8%84%9A%E6%89%8B%E6%9E%B6/" rel="tag">脚手架</a></li></ul>

    </footer>
  </div>

    
 
    
</article>

    
    <article
  id="post-qdgch"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2021/10/07/qdgch/"
    >自动化构建</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2021/10/07/qdgch/" class="article-date">
  <time datetime="2021-10-07T04:46:57.000Z" itemprop="datePublished">2021-10-07</time>
</a>    
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h4 id="自动化构建"><a href="#自动化构建" class="headerlink" title="自动化构建"></a>自动化构建</h4><p>自动化就是指机器代替手工去完成工作，构建可以理解为转换，自动化构建呢就是把源代码转换成生产环境中可以运行的代码或程序。这样的转换过程就叫做自动化构建工作流<br>作用就是脱离运行环境兼容带来的问题，在开发阶段使用提高效率的语法、规范和标准</p>
<p>典型的应用场景: 一些不被浏览器直接支持的用法如esNext sass 模板引擎，这时自动化构建工具就派上用场了</p>
<p>常用的自动化构建工具<br>grunt: 最早的前端构建系统，插件生态非常完善，几乎可以完成任何事，速度慢，磁盘读写操作多<br>gulp: 基于内存实现，速度较快，可以同时执行多个任务，插件系统也很完善，最流行<br>FIS: 百度团队推出，捆绑套餐，大而全, 易上手</p>
<p><strong>自动化构建初体验</strong><br>使用sass控制样式<br>安装历来: yarn add sass –dev<br>它会装在.bin目录下<br>然后运行命令时代码从输入路径转到输出路径:<br>.\node_modules.bin\sass scss/main.scss css/style.css<br>如果每次输入命令就很麻烦, 后人不知你如何操作, 所以使用npm scripts来包装命令(是实现自动化构建工作流的最简单的方式）<br>在package.json中添加scripts</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;scripts&quot;</span> : &#123;</span><br><span class="line">    <span class="string">&quot;build&quot;</span> : <span class="string">&quot;sass scss/main.scss css/style.css&quot;</span></span><br><span class="line">&#125;，</span><br></pre></td></tr></table></figure>
<p>然后yarn build(npm run build)就可以了</p>
<p>看如何操作<br>yarn add browser-sync –dev 用来启动一个测试服务器去运行项目</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;scripts&quot;</span> : &#123;</span><br><span class="line">    <span class="string">&quot;build&quot;</span> : <span class="string">&quot;sass scss/main.scss css/style.css&quot;</span>，</span><br><span class="line">    <span class="string">&quot;serve&quot;</span> : <span class="string">&quot;browser-sync .&quot;</span> <span class="comment">//（.是运行当前的目录）</span></span><br><span class="line">&#125;，</span><br></pre></td></tr></table></figure>
<p>yarn serve  此时browser-sync会自动运行服务器并唤起浏览器<br>如果在browser-sync生成之前并没有生成样式, 此时browser工作的时候就没有样式文件<br>此时就可以使用scripts的钩子命令</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;scripts&quot;</span> : &#123;</span><br><span class="line">    <span class="string">&quot;build&quot;</span> : <span class="string">&quot;sass scss/main.scss css/style.css&quot;</span>，</span><br><span class="line">    <span class="string">&quot;preserve&quot;</span> : <span class="string">&quot;yarn build&quot;</span>, <span class="comment">//顾名思义 会在serve之前执行</span></span><br><span class="line">    <span class="string">&quot;serve&quot;</span> : <span class="string">&quot;browser-sync .&quot;</span> </span><br><span class="line">&#125;，</span><br></pre></td></tr></table></figure>
<p>添加–watch可以监听文件的改变，改写sass保存后，css就会改变</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;scripts&quot;</span> : &#123;</span><br><span class="line">    <span class="string">&quot;build&quot;</span> : <span class="string">&quot;sass scss/main.scss css/style.css --watch&quot;</span>，<span class="comment">//添加watch</span></span><br><span class="line">    <span class="string">&quot;preserve&quot;</span> : <span class="string">&quot;yarn build&quot;</span>, </span><br><span class="line">    <span class="string">&quot;serve&quot;</span> : <span class="string">&quot;browser-sync .&quot;</span> </span><br><span class="line">&#125;，</span><br></pre></td></tr></table></figure>
<p>使用npm-run-all可以同步执行不阻塞<br>yarn add npm-run-all –dev</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;scripts&quot;</span> : &#123;</span><br><span class="line">    <span class="string">&quot;build&quot;</span> : <span class="string">&quot;sass scss/main.scss css/style.css --watch&quot;</span>，</span><br><span class="line">    <span class="string">&quot;serve&quot;</span> : <span class="string">&quot;browser-sync .&quot;</span> </span><br><span class="line">    <span class="string">&quot;start&quot;</span> : <span class="string">&quot;run-p build serve &quot;</span> <span class="comment">//这个模块使用start run-p来声明同时执行的步骤</span></span><br><span class="line">&#125;，</span><br></pre></td></tr></table></figure>
<p>yarn start时 build和serve就被同时执行了</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;scripts&quot;</span> : &#123;</span><br><span class="line">    <span class="string">&quot;build&quot;</span> : <span class="string">&quot;sass scss/main.scss css/style.css --watch&quot;</span>，</span><br><span class="line">    <span class="string">&quot;serve&quot;</span> : <span class="string">&quot;browser-sync . --files \css/*.css\&quot;&quot;</span> <span class="comment">//可以让browser-sync在启动过后监听文件的变化，网页就能自动刷新了</span></span><br><span class="line">    <span class="string">&quot;start&quot;</span> : <span class="string">&quot;run-p build serve &quot;</span> </span><br><span class="line">&#125;，</span><br></pre></td></tr></table></figure>


<h4 id="grunt基本使用"><a href="#grunt基本使用" class="headerlink" title="grunt基本使用"></a>grunt基本使用</h4><p><strong>创建</strong><br>yarn init –yes<br>yarn add grunt<br>code gruntfile.js<br>gruntfile.js是 Grunt 的入口文件, 用于定义一些需要 Grunt 自动执行的任务, 需要导出一个函数, 此函数接收一个 grunt 的对象类型的形参<br>grunt 对象中会提供一些创建任务时会用到的 API</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="params">grunt</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// grunt.initConfig() 用于为任务添加一些配置选项</span></span><br><span class="line">  grunt.initConfig(&#123;</span><br><span class="line">    <span class="comment">// 键一般对应任务的名称</span></span><br><span class="line">    <span class="comment">// 值可以是任意类型的数据</span></span><br><span class="line">    <span class="attr">foo</span>: &#123;</span><br><span class="line">      <span class="attr">bar</span>: <span class="string">&#x27;baz&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  grunt.registerTask(<span class="string">&#x27;foo&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 任务中可以使用 grunt.config() 获取配置</span></span><br><span class="line">    <span class="built_in">console</span>.log(grunt.config(<span class="string">&#x27;foo&#x27;</span>))</span><br><span class="line">    <span class="comment">// 如果属性值是对象的话，config 中可以使用点的方式定位对象中属性的值</span></span><br><span class="line">    <span class="built_in">console</span>.log(grunt.config(<span class="string">&#x27;foo.bar&#x27;</span>))</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  grunt.registerTask(<span class="string">&#x27;foo&#x27;</span>, <span class="string">&#x27;a sample task&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;hello grunt&#x27;</span>)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  grunt.registerTask(<span class="string">&#x27;bar&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;other task&#x27;</span>)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// // default 是默认任务名称</span></span><br><span class="line">  <span class="comment">// // 通过 grunt 执行时可以省略</span></span><br><span class="line">  <span class="comment">// grunt.registerTask(&#x27;default&#x27;, () =&gt; &#123;</span></span><br><span class="line">  <span class="comment">//   console.log(&#x27;default task&#x27;)</span></span><br><span class="line">  <span class="comment">// &#125;)</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 第二个参数可以指定此任务的映射任务，</span></span><br><span class="line">  <span class="comment">// 这样执行 default 就相当于执行对应的任务</span></span><br><span class="line">  <span class="comment">// 这里映射的任务会按顺序依次执行，不会同步执行</span></span><br><span class="line">  grunt.registerTask(<span class="string">&#x27;default&#x27;</span>, [<span class="string">&#x27;foo&#x27;</span>, <span class="string">&#x27;bar&#x27;</span>])</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 也可以在任务函数中执行其他任务</span></span><br><span class="line">  grunt.registerTask(<span class="string">&#x27;run-other&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// foo 和 bar 会在当前任务执行完成过后自动依次执行</span></span><br><span class="line">    grunt.task.run(<span class="string">&#x27;foo&#x27;</span>, <span class="string">&#x27;bar&#x27;</span>)</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;current task runing~&#x27;</span>)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 默认 grunt 采用同步模式编码</span></span><br><span class="line">  <span class="comment">// 如果需要异步可以使用 this.async() 方法创建回调函数</span></span><br><span class="line">  <span class="comment">// grunt.registerTask(&#x27;async-task&#x27;, () =&gt; &#123;</span></span><br><span class="line">  <span class="comment">//   setTimeout(() =&gt; &#123;</span></span><br><span class="line">  <span class="comment">//     console.log(&#x27;async task working~&#x27;)</span></span><br><span class="line">  <span class="comment">//   &#125;, 1000)</span></span><br><span class="line">  <span class="comment">// &#125;)</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// 由于函数体中需要使用 this，所以这里不能使用箭头函数</span></span><br><span class="line">  grunt.registerTask(<span class="string">&#x27;async-task&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> done = <span class="built_in">this</span>.async()</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&#x27;async task working~&#x27;</span>)</span><br><span class="line">      done()</span><br><span class="line">    &#125;, <span class="number">1000</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>yarn grunt foo/bar (不写就是默认, 默认中的数组顺序执行)</p>
<p><strong>标记任务失败</strong><br>使用return false标记失败, 后面的任务就不会被执行了, 如果执行 yarn grunt default –force 会继续执行失败后面的任务,<br>如果是异步的就使用done(false)来标记</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="params">grunt</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 任务函数执行过程中如果返回 false</span></span><br><span class="line">  <span class="comment">// 则意味着此任务执行失败</span></span><br><span class="line">  grunt.registerTask(<span class="string">&#x27;bad&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;bad working~&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  grunt.registerTask(<span class="string">&#x27;foo&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;foo working~&#x27;</span>)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  grunt.registerTask(<span class="string">&#x27;bar&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;bar working~&#x27;</span>)</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 如果一个任务列表中的某个任务执行失败</span></span><br><span class="line">  <span class="comment">// 则后续任务默认不会运行</span></span><br><span class="line">  <span class="comment">// 除非 grunt 运行时指定 --force 参数强制执行</span></span><br><span class="line">  grunt.registerTask(<span class="string">&#x27;default&#x27;</span>, [<span class="string">&#x27;foo&#x27;</span>, <span class="string">&#x27;bad&#x27;</span>, <span class="string">&#x27;bar&#x27;</span>])</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 异步函数中标记当前任务执行失败的方式是为回调函数指定一个 false 的实参</span></span><br><span class="line">  grunt.registerTask(<span class="string">&#x27;bad-async&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> done = <span class="built_in">this</span>.async()</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&#x27;async task working~&#x27;</span>)</span><br><span class="line">      done(<span class="literal">false</span>)</span><br><span class="line">    &#125;, <span class="number">1000</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>配置选项方法</strong><br>initConfig: 可以用这种方法配置压缩文件路径, 键与文件名称保持一致</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="params">grunt</span> =&gt;</span> &#123;</span><br><span class="line">  grunt.initConfig(&#123;</span><br><span class="line">    <span class="attr">build</span>: &#123;</span><br><span class="line">      <span class="attr">options</span>: &#123;</span><br><span class="line">        <span class="attr">msg</span>: <span class="string">&#x27;task options&#x27;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">foo</span>: &#123;</span><br><span class="line">        <span class="attr">options</span>: &#123;</span><br><span class="line">          <span class="attr">msg</span>: <span class="string">&#x27;foo target options&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">bar</span>: <span class="string">&#x27;456&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  grunt.registerMultiTask(<span class="string">&#x27;build&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">this</span>.options())</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p><strong>多目标任务</strong><br>.registerMultiTask<br>需要initconfig一个和任务名同名的属性, 属性值一定是个对象, 对象中每个属性的名字就是目标名称</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="params">grunt</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 多目标模式，可以让任务根据配置形成多个子任务</span></span><br><span class="line">  grunt.initConfig(&#123;</span><br><span class="line">    <span class="attr">build</span>: &#123;</span><br><span class="line">      <span class="attr">foo</span>: <span class="number">100</span>,</span><br><span class="line">      <span class="attr">bar</span>: <span class="string">&#x27;456&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  grunt.registerMultiTask(<span class="string">&#x27;build&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`task: build, target: <span class="subst">$&#123;<span class="built_in">this</span>.target&#125;</span>, data: <span class="subst">$&#123;<span class="built_in">this</span>.data&#125;</span>`</span>)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>yarn grunt build<br>yarn grunt build:bar</p>
<p>options是一个方法, 可以拿配置选项, 如果写在属性里面会覆盖外层</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="params">grunt</span> =&gt;</span> &#123;</span><br><span class="line">  grunt.initConfig(&#123;</span><br><span class="line">    <span class="attr">build</span>: &#123;</span><br><span class="line">      <span class="attr">options</span>: &#123;</span><br><span class="line">        <span class="attr">msg</span>: <span class="string">&#x27;task options&#x27;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">foo</span>: &#123;</span><br><span class="line">        <span class="attr">options</span>: &#123;</span><br><span class="line">          <span class="attr">msg</span>: <span class="string">&#x27;foo target options&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">bar</span>: <span class="string">&#x27;456&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  grunt.registerMultiTask(<span class="string">&#x27;build&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">this</span>.options())</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>插件的使用</strong><br>插件是grunt的核心, 大体是用npm安装, 在gruntfile里面加载<br>如清理插件: yarn add grunt-contrib-clean</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="params">grunt</span> =&gt;</span> &#123;</span><br><span class="line">  grunt.initConfig(&#123;</span><br><span class="line">    <span class="comment">//grunt的插件一般是以grunt-contrib-name命名的, 所以属性名是clean</span></span><br><span class="line">    <span class="attr">clean</span>: &#123;</span><br><span class="line">      <span class="attr">temp</span>: <span class="string">&#x27;temp/**&#x27;</span> <span class="comment">//temp可以指定具体，也可以通配符, 如temp/*.txt, temp/**</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  grunt.loadNpmTasks(<span class="string">&#x27;grunt-contrib-clean&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>常用插件</strong><br>1.sass css的转换</p>
<blockquote>
<p>yarn add grunt-sass sass –dev</p>
</blockquote>
<p>2.babel ex新特性的转换</p>
<blockquote>
<p>yarn add grunt-babel @babel/core @babel/preset-env –dev</p>
</blockquote>
<p>3.watch 监视</p>
<blockquote>
<p>yarn add grunt-contrib-watch –dev</p>
</blockquote>
<h4 id="gulp的基本使用"><a href="#gulp的基本使用" class="headerlink" title="gulp的基本使用"></a>gulp的基本使用</h4><p>The streaming build system</p>
<p><strong>基本使用</strong><br>安装开发依赖 </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yarn init --yes</span><br><span class="line">yarn add gulp --dev<span class="comment">//(同时会安装gulp-cli,也就是说会在.bin下有个命令）</span></span><br><span class="line">code gulpfile.js</span><br></pre></td></tr></table></figure>

<p>gulp通过导出函数成员的方式去定义, 导出的函数都会作为 gulp 任务</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// gulp 的任务函数都是异步的</span></span><br><span class="line"><span class="comment">// 可以通过调用回调函数标识任务完成</span></span><br><span class="line"><span class="built_in">exports</span>.foo = <span class="function"><span class="params">done</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;foo task working~&#x27;</span>)</span><br><span class="line">  done() <span class="comment">// 标识任务执行完成</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>yarn gulp foo</p>
<p>gulp4.0以前需要载入gulp模块, 然后使用gulp.task()方法注册任务, 不过这种方式已经不被推荐了</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> gulp = <span class="built_in">require</span>(<span class="string">&#x27;gulp&#x27;</span>)</span><br><span class="line"></span><br><span class="line">gulp.task(<span class="string">&#x27;bar&#x27;</span>, <span class="function"><span class="params">done</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;bar task working~&#x27;</span>)</span><br><span class="line">  done()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>yarn gulp bar</p>
<p><strong>默认任务</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// default 是默认任务</span></span><br><span class="line"><span class="comment">// 在运行是可以省略任务名参数</span></span><br><span class="line"><span class="built_in">exports</span>.default = <span class="function"><span class="params">done</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;default task working~&#x27;</span>)</span><br><span class="line">  done()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>yarn gulp</p>
<p><strong>组合任务</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//series会依次执行, parallel会并行执行</span></span><br><span class="line"><span class="keyword">const</span> &#123; series, parallel &#125; = <span class="built_in">require</span>(<span class="string">&#x27;gulp&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> task1 = <span class="function"><span class="params">done</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;task1 working~&#x27;</span>)</span><br><span class="line">    done()</span><br><span class="line">  &#125;, <span class="number">1000</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> task2 = <span class="function"><span class="params">done</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;task2 working~&#x27;</span>)</span><br><span class="line">    done()</span><br><span class="line">  &#125;, <span class="number">1000</span>)  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> task3 = <span class="function"><span class="params">done</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;task3 working~&#x27;</span>)</span><br><span class="line">    done()</span><br><span class="line">  &#125;, <span class="number">1000</span>)  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 让多个任务按照顺序依次执行</span></span><br><span class="line"><span class="built_in">exports</span>.foo = series(task1, task2, task3)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 让多个任务同时执行</span></span><br><span class="line"><span class="built_in">exports</span>.bar = parallel(task1, task2, task3)</span><br></pre></td></tr></table></figure>


<p><strong>异步任务的三种方式</strong><br>1.错误优先的回调函数</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">exports</span>.callback = <span class="function"><span class="params">done</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;callback task&#x27;</span>)</span><br><span class="line">  done()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.callback_error = <span class="function"><span class="params">done</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;callback task&#x27;</span>)</span><br><span class="line">  done(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&#x27;task failed&#x27;</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>2.promise</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">exports</span>.promise = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;promise task&#x27;</span>)</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Promise</span>.resolve()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.promise_error = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;promise task&#x27;</span>)</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(<span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&#x27;task failed&#x27;</span>))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> timeout = <span class="function"><span class="params">time</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(resolve, time)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>async await (是语法糖，实际上还是promise）</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">exports</span>.async = <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">await</span> timeout(<span class="number">1000</span>)</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;async task&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>3.stream （是其他方式中最为常见的方式）<br>readStream  end的时候结束</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.stream = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> read = fs.createReadStream(<span class="string">&#x27;yarn.lock&#x27;</span>)</span><br><span class="line">  <span class="keyword">const</span> write = fs.createWriteStream(<span class="string">&#x27;a.txt&#x27;</span>)</span><br><span class="line">  read.pipe(write)</span><br><span class="line">  <span class="keyword">return</span> read</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.stream = <span class="function"><span class="params">done</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> read = fs.createReadStream(<span class="string">&#x27;yarn.lock&#x27;</span>)</span><br><span class="line">  <span class="keyword">const</span> write = fs.createWriteStream(<span class="string">&#x27;a.txt&#x27;</span>)</span><br><span class="line">  read.pipe(write)</span><br><span class="line">  read.on(<span class="string">&#x27;end&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    done()</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p><strong>构建过程核心工作原理</strong><br>通过api模拟构建过程, 这是直接写入</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> &#123; Transform &#125; = <span class="built_in">require</span>(<span class="string">&#x27;stream&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">exports</span>.default = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> readStream = fs.createReadStream(<span class="string">&#x27;normalize.css&#x27;</span>)  <span class="comment">// 文件读取流</span></span><br><span class="line">  <span class="keyword">const</span> writeStream = fs.createWriteStream(<span class="string">&#x27;normalize.min.css&#x27;</span>)  <span class="comment">// 文件写入流</span></span><br><span class="line">  <span class="keyword">const</span> transformStream = <span class="keyword">new</span> Transform(&#123;  <span class="comment">// 文件转换流</span></span><br><span class="line">    <span class="comment">// 核心转换过程</span></span><br><span class="line">    <span class="attr">transform</span>: <span class="function">(<span class="params">chunk, encoding, callback</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> input = chunk.toString()</span><br><span class="line">      <span class="keyword">const</span> output = input.replace(<span class="regexp">/\s+/g</span>, <span class="string">&#x27;&#x27;</span>).replace(<span class="regexp">/\/\*.+?\*\//g</span>, <span class="string">&#x27;&#x27;</span>) <span class="comment">//input先把空白字符替换掉，再替换掉注释</span></span><br><span class="line">      callback(<span class="literal">null</span>, output) <span class="comment">//callback是错误优先的对象 没有错误时第一个参数传null</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> readStream</span><br><span class="line">    .pipe(transformStream) <span class="comment">// 转换</span></span><br><span class="line">    .pipe(writeStream) <span class="comment">// 写入</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>yarn gulp</p>
<p><strong>文件操作</strong><br>读写: API+插件的使用, src（）创建读取流, dest（）创建写入流<br>对css的压缩转换: 安装依赖: yarn add gulp-clean-css –dev<br>重命名: 安装依赖: yarn add gulp-rename –dev</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">exports</span>.default = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> src(<span class="string">&#x27;src/*.css&#x27;</span>)</span><br><span class="line">    .pipe(cleanCSS())</span><br><span class="line">    .pipe(rename(&#123; <span class="attr">extname</span>: <span class="string">&#x27;.min.css&#x27;</span> &#125;))</span><br><span class="line">    .pipe(dest(<span class="string">&#x27;dist&#x27;</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>yarn gulp<br>以上使用pipe src读取流，再pipe dest写入流的操作就是我们使用gulp的常规操作</p>
<h4 id="FIS基本使用"><a href="#FIS基本使用" class="headerlink" title="FIS基本使用"></a>FIS基本使用</h4><p>fis不如前两个用的多, 也很久没更新版本了, 它高度集成</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yarn <span class="built_in">global</span> fis3 </span><br><span class="line">fis3 release</span><br><span class="line">fis3 release -d output</span><br></pre></td></tr></table></figure>

<p>添加fis-config.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">fis.match(<span class="string">&#x27;*.&#123;js,scss,png&#125;&#x27;</span>, &#123;</span><br><span class="line">  <span class="attr">release</span>: <span class="string">&#x27;/assets/$0&#x27;</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">fis.match(<span class="string">&#x27;**/*.scss&#x27;</span>, &#123;</span><br><span class="line">  <span class="attr">rExt</span>: <span class="string">&#x27;.css&#x27;</span>,</span><br><span class="line">  <span class="attr">parser</span>: fis.plugin(<span class="string">&#x27;node-sass&#x27;</span>),</span><br><span class="line">  <span class="attr">optimizer</span>: fis.plugin(<span class="string">&#x27;clean-css&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">fis.match(<span class="string">&#x27;**/*.js&#x27;</span>, &#123;</span><br><span class="line">  <span class="attr">parser</span>: fis.plugin(<span class="string">&#x27;babel-6.x&#x27;</span>),</span><br><span class="line">  <span class="attr">optimizer</span>: fis.plugin(<span class="string">&#x27;uglify-js&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>fis3 release -d output</p>
<p>编译与压缩<br>yarn global add fis-parser-node-sass</p>
<h4 id="写在最后"><a href="#写在最后" class="headerlink" title="写在最后"></a>写在最后</h4><p>原创博文, 如有错误, 敬请指导!</p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/FIS/" rel="tag">FIS</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/grunt/" rel="tag">grunt</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/gulp/" rel="tag">gulp</a></li></ul>

    </footer>
  </div>

    
 
    
</article>

    
    <article
  id="post-xysyl"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2021/09/19/xysyl/"
    >响应式原理</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2021/09/19/xysyl/" class="article-date">
  <time datetime="2021-09-19T07:37:19.000Z" itemprop="datePublished">2021-09-19</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%89%8D%E7%AB%AF%E8%BF%9B%E9%98%B6%E7%AC%94%E8%AE%B0/">前端进阶笔记</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h4 id="响应式原理"><a href="#响应式原理" class="headerlink" title="响应式原理"></a>响应式原理</h4><p>·数据响应式<br>·数据模型仅仅是普通的JavaScript 对象，而当我们修改数据时，视图会进行更新，避免了繁琐的DOM操作，提高开发效率<br>·双向绑定<br>·数据改变，视图改变;视图改变，数据也随之改变·我们可以使用v-model在表单元素上创建双向数据绑定·数据驱动是Vue最独特的特性之一<br>·开发过程中仅需要关注数据本身，不需要关心数据是如何渲染到视图</p>
<p><strong>深入响应式原理</strong><br>vue2.x中的响应式原理是基于defineProperty 来实现的, ie8以下不支持<br>数据劫持：当访问或者设置 vm 中的成员的时候，做一些干预操作<br>其中有三个参数</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> data = &#123;</span><br><span class="line">    <span class="attr">msg</span>: <span class="string">&#x27;hello&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 模拟 Vue 的实例</span></span><br><span class="line"><span class="keyword">let</span> vm = &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 数据劫持：当访问或者设置 vm 中的成员的时候，做一些干预操作</span></span><br><span class="line"><span class="built_in">Object</span>.defineProperty(vm, <span class="string">&#x27;msg&#x27;</span>, &#123;</span><br><span class="line">    <span class="comment">// 可枚举（可遍历）</span></span><br><span class="line">    <span class="attr">enumerable</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="comment">// 可配置（可以使用 delete 删除，可以通过 defineProperty 重新定义）</span></span><br><span class="line">    <span class="attr">configurable</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="comment">// 当获取值的时候执行</span></span><br><span class="line">    get () &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;get: &#x27;</span>, data.msg)</span><br><span class="line">        <span class="keyword">return</span> data.msg</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 当设置值的时候执行</span></span><br><span class="line">    set (newValue) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;set: &#x27;</span>, newValue)</span><br><span class="line">        <span class="keyword">if</span> (newValue === data.msg) &#123;</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        data.msg = newValue</span><br><span class="line">        <span class="comment">// 数据更改，更新 DOM 的值</span></span><br><span class="line">        <span class="built_in">document</span>.querySelector(<span class="string">&#x27;#app&#x27;</span>).textContent = data.msg</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>3.0是基于 proxy 实现, 直接监听对象而非属性, 是es6中新增的, ie不支持,性能由浏览器优化<br>proxy是一个构造函数 通过new来实例</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> data = &#123;</span><br><span class="line">    <span class="attr">msg</span>: <span class="string">&#x27;hello&#x27;</span>,</span><br><span class="line">    <span class="attr">count</span>: <span class="number">10</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 模拟 Vue 的实例</span></span><br><span class="line"><span class="keyword">let</span> vm = &#123;&#125;</span><br><span class="line"></span><br><span class="line">proxyData(data)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">proxyData</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 遍历 data 对象的所有属性</span></span><br><span class="line">    <span class="built_in">Object</span>.keys(data).forEach(<span class="function"><span class="params">key</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 把 data 中的属性，转换成 vm 的 setter/setter</span></span><br><span class="line">    <span class="built_in">Object</span>.defineProperty(vm, key, &#123;</span><br><span class="line">        <span class="attr">enumerable</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">configurable</span>: <span class="literal">true</span>,</span><br><span class="line">        get () &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&#x27;get: &#x27;</span>, key, data[key])</span><br><span class="line">            <span class="keyword">return</span> data[key]</span><br><span class="line">        &#125;,</span><br><span class="line">        set (newValue) &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&#x27;set: &#x27;</span>, key, newValue)</span><br><span class="line">            <span class="keyword">if</span> (newValue === data[key]) &#123;</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            &#125;</span><br><span class="line">            data[key] = newValue</span><br><span class="line">            <span class="comment">// 数据更改，更新 DOM 的值</span></span><br><span class="line">            <span class="built_in">document</span>.querySelector(<span class="string">&#x27;#app&#x27;</span>).textContent = data[key]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>2比1简洁的多  性能也要好一点</p>
<p><strong>发布订阅模式</strong><br>vue的自定义事件  </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Vue 自定义事件</span></span><br><span class="line"><span class="keyword">let</span> vm = <span class="keyword">new</span> Vue()</span><br><span class="line"><span class="comment">// &#123; &#x27;click&#x27;: [fn1, fn2], &#x27;change&#x27;: [fn] &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 注册事件(订阅消息)</span></span><br><span class="line">vm.$on(<span class="string">&#x27;dataChange&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;dataChange&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">vm.$on(<span class="string">&#x27;dataChange&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;dataChange1&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 触发事件(发布消息)</span></span><br><span class="line">vm.$emit(<span class="string">&#x27;dataChange&#x27;</span>)</span><br></pre></td></tr></table></figure>


<p>发布订阅模式</p>
<p>订阅者$on  发布者$emint 信号中心 let vm = new Vue()</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 事件触发器</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">EventEmitter</span> </span>&#123;</span><br><span class="line">    <span class="title">constructor</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// &#123; &#x27;click&#x27;: [fn1, fn2], &#x27;change&#x27;: [fn] &#125;</span></span><br><span class="line">    <span class="built_in">this</span>.subs = <span class="built_in">Object</span>.create(<span class="literal">null</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 注册事件</span></span><br><span class="line">    $on (eventType, handler) &#123;</span><br><span class="line">    <span class="built_in">this</span>.subs[eventType] = <span class="built_in">this</span>.subs[eventType] || []</span><br><span class="line">    <span class="built_in">this</span>.subs[eventType].push(handler)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 触发事件</span></span><br><span class="line">    $emit (eventType) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.subs[eventType]) &#123;</span><br><span class="line">        <span class="built_in">this</span>.subs[eventType].forEach(<span class="function"><span class="params">handler</span> =&gt;</span> &#123;</span><br><span class="line">        handler()</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 测试</span></span><br><span class="line"><span class="keyword">let</span> em = <span class="keyword">new</span> EventEmitter()</span><br><span class="line">em.$on(<span class="string">&#x27;click&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;click1&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line">em.$on(<span class="string">&#x27;click&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;click2&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">em.$emit(<span class="string">&#x27;click&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>观察者模式 没有事件中心  发布者知道订阅者的存在</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 发布者-目标</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dep</span> </span>&#123;</span><br><span class="line">    <span class="title">constructor</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 记录所有的订阅者</span></span><br><span class="line">    <span class="built_in">this</span>.subs = []</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 添加订阅者</span></span><br><span class="line">    addSub (sub) &#123;</span><br><span class="line">    <span class="keyword">if</span> (sub &amp;&amp; sub.update) &#123;</span><br><span class="line">        <span class="built_in">this</span>.subs.push(sub)</span><br><span class="line">    &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 发布通知</span></span><br><span class="line">    notify () &#123;</span><br><span class="line">    <span class="built_in">this</span>.subs.forEach(<span class="function"><span class="params">sub</span> =&gt;</span> &#123;</span><br><span class="line">        sub.update()</span><br><span class="line">    &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 订阅者-观察者</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Watcher</span> </span>&#123;</span><br><span class="line">    update () &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;update&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 测试</span></span><br><span class="line"><span class="keyword">let</span> dep = <span class="keyword">new</span> Dep()</span><br><span class="line"><span class="keyword">let</span> watcher = <span class="keyword">new</span> Watcher()</span><br><span class="line"></span><br><span class="line">dep.addSub(watcher)</span><br><span class="line"></span><br><span class="line">dep.notify()</span><br></pre></td></tr></table></figure>
<p>总结<br>.观察者模式是由具体目标调度，比如当事件触发，Dep 就会去调用观察者的方法，所以观察者模式的订阅者与发布者<br>之间是存在依赖的。<br>.发布/订阅模式由统-调度中心调用，因此发布者和订阅者不需要知道对方的存在。<br><img src="/2021/09/19/xysyl/QQ20210625-163604@2x.png" alt="观察者模式和发布订阅模式"></p>
<h4 id="响应式部分代码实现"><a href="#响应式部分代码实现" class="headerlink" title="响应式部分代码实现"></a>响应式部分代码实现</h4><p>部分解释写在注释中,代码下载地址<a target="_blank" rel="noopener" href="https://github.com/Levxn7/lagouhomework/tree/master/part3/fed-e-task-03-01/second">https://github.com/Levxn7/lagouhomework/tree/master/part3/fed-e-task-03-01/second</a></p>
<blockquote>
<p>html</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;cn&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;ie=edge&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>Mini Vue<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-html</span>=<span class="string">&quot;html&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">v-on:click</span>=<span class="string">&quot;clicked&quot;</span>&gt;</span>点击<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- &lt;button v-on=&quot;&#123;click:click&#125;&quot;&gt;点击&lt;/button&gt; --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- ,mouseenter:onenter,mouseleave:leave --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>差值表达式<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>&#123;&#123; msg &#125;&#125;<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h3</span>&gt;</span>&#123;&#123; count &#125;&#125;<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>v-text<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">v-text</span>=<span class="string">&quot;msg&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>v-model<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;msg&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;count&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./js/dep.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./js/watcher.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./js/compiler.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./js/observer.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./js/vue.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">    <span class="keyword">let</span> vm = <span class="keyword">new</span> Vue(&#123;</span></span><br><span class="line"><span class="javascript">      <span class="attr">el</span>: <span class="string">&#x27;#app&#x27;</span>,</span></span><br><span class="line"><span class="javascript">      <span class="attr">data</span>: &#123;</span></span><br><span class="line"><span class="javascript">        <span class="attr">msg</span>: <span class="string">&#x27;Hello Vue&#x27;</span>,</span></span><br><span class="line"><span class="javascript">        <span class="attr">count</span>: <span class="number">100</span>,</span></span><br><span class="line"><span class="javascript">        <span class="attr">person</span>: &#123; <span class="attr">name</span>: <span class="string">&#x27;zs&#x27;</span> &#125;,</span></span><br><span class="line"><span class="javascript">        <span class="attr">html</span>: <span class="string">&quot;&lt;h1&gt;这是一个h1标签&lt;/h1&gt;&quot;</span></span></span><br><span class="line"><span class="javascript">      &#125;,</span></span><br><span class="line"><span class="javascript">      <span class="attr">methods</span>:&#123; </span></span><br><span class="line"><span class="javascript">        <span class="attr">clicked</span>:<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(<span class="string">&quot;被点击了&quot;</span>);</span></span><br><span class="line"><span class="javascript">        &#125;</span></span><br><span class="line"><span class="javascript">      &#125;</span></span><br><span class="line"><span class="javascript">    &#125;)</span></span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(vm.msg)</span></span><br><span class="line"><span class="javascript">    <span class="comment">// vm.msg = &#123; test: &#x27;Hello&#x27; &#125;</span></span></span><br><span class="line"><span class="javascript">    vm.test = <span class="string">&#x27;abc&#x27;</span></span></span><br><span class="line"><span class="javascript">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>dep.js</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dep</span> </span>&#123;</span><br><span class="line">  <span class="title">constructor</span> (<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 存储所有的观察者</span></span><br><span class="line">    <span class="built_in">this</span>.subs = []</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 添加观察者</span></span><br><span class="line">  addSub (sub) &#123;</span><br><span class="line">    <span class="keyword">if</span> (sub &amp;&amp; sub.update) &#123;</span><br><span class="line">      <span class="built_in">this</span>.subs.push(sub)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 发送通知</span></span><br><span class="line">  notify () &#123;</span><br><span class="line">    <span class="built_in">this</span>.subs.forEach(<span class="function"><span class="params">sub</span> =&gt;</span> &#123;</span><br><span class="line">      sub.update()</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>watcher.js</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Watcher</span> </span>&#123;</span><br><span class="line">  <span class="title">constructor</span> (<span class="params">vm, key, cb</span>) &#123;</span><br><span class="line">    <span class="built_in">this</span>.vm = vm</span><br><span class="line">    <span class="comment">// data中的属性名称</span></span><br><span class="line">    <span class="built_in">this</span>.key = key</span><br><span class="line">    <span class="comment">// 回调函数负责更新视图</span></span><br><span class="line">    <span class="built_in">this</span>.cb = cb</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 把watcher对象记录到Dep类的静态属性target</span></span><br><span class="line">    Dep.target = <span class="built_in">this</span></span><br><span class="line">    <span class="comment">// 触发get方法，在get方法中会调用addSub</span></span><br><span class="line">    <span class="built_in">this</span>.oldValue = vm[key]</span><br><span class="line">    Dep.target = <span class="literal">null</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 当数据发生变化的时候更新视图</span></span><br><span class="line">  update () &#123;</span><br><span class="line">    <span class="keyword">let</span> newValue = <span class="built_in">this</span>.vm[<span class="built_in">this</span>.key]</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.oldValue === newValue) &#123;</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">this</span>.cb(newValue)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>compiler.js</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Compiler</span> </span>&#123;</span><br><span class="line">  <span class="title">constructor</span> (<span class="params">vm</span>) &#123;</span><br><span class="line">    <span class="built_in">this</span>.el = vm.$el</span><br><span class="line">    <span class="built_in">this</span>.vm = vm</span><br><span class="line">    <span class="built_in">this</span>.methods = vm.$methods</span><br><span class="line">    <span class="built_in">this</span>.compile(<span class="built_in">this</span>.el)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 编译模板，处理文本节点和元素节点</span></span><br><span class="line">  compile (el) &#123;</span><br><span class="line">    <span class="keyword">let</span> childNodes = el.childNodes</span><br><span class="line">    <span class="built_in">Array</span>.from(childNodes).forEach(<span class="function"><span class="params">node</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 处理文本节点</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">this</span>.isTextNode(node)) &#123;</span><br><span class="line">        <span class="built_in">this</span>.compileText(node)</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">this</span>.isElementNode(node)) &#123;</span><br><span class="line">        <span class="comment">// 处理元素节点</span></span><br><span class="line">        <span class="built_in">this</span>.compileElement(node)</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 判断node节点，是否有子节点，如果有子节点，要递归调用compile</span></span><br><span class="line">      <span class="keyword">if</span> (node.childNodes &amp;&amp; node.childNodes.length) &#123;</span><br><span class="line">        <span class="built_in">this</span>.compile(node)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 编译元素节点，处理指令</span></span><br><span class="line">  compileElement (node) &#123;</span><br><span class="line">    <span class="comment">// console.log(node.attributes)</span></span><br><span class="line">    <span class="comment">// 遍历所有的属性节点</span></span><br><span class="line">    <span class="built_in">Array</span>.from(node.attributes).forEach(<span class="function"><span class="params">attr</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 判断是否是指令</span></span><br><span class="line">      <span class="keyword">let</span> attrName = attr.name</span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">this</span>.isDirective(attrName)) &#123;</span><br><span class="line">        <span class="comment">// v-text --&gt; text</span></span><br><span class="line">        attrName = attrName.substr(<span class="number">2</span>)</span><br><span class="line">        <span class="keyword">let</span> key = attr.value</span><br><span class="line">        <span class="built_in">this</span>.update(node, key, attrName)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  update (node, key, attrName) &#123;</span><br><span class="line">    <span class="keyword">let</span> updateFn</span><br><span class="line">    <span class="keyword">if</span> (attrName.substr(<span class="number">0</span>,<span class="number">3</span>) === <span class="string">&#x27;on:&#x27;</span>) &#123;</span><br><span class="line">      updateFn = <span class="built_in">this</span>[attrName.substr(<span class="number">0</span>,<span class="number">2</span>) + <span class="string">&#x27;Updater&#x27;</span>]</span><br><span class="line">      updateFn &amp;&amp; updateFn.call(<span class="built_in">this</span>, node, <span class="built_in">this</span>.methods[key], attrName.substr(<span class="number">3</span>))</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      updateFn = <span class="built_in">this</span>[attrName + <span class="string">&#x27;Updater&#x27;</span>]</span><br><span class="line">      updateFn &amp;&amp; updateFn.call(<span class="built_in">this</span>, node, <span class="built_in">this</span>.vm[key], key)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 处理 v-text 指令</span></span><br><span class="line">  textUpdater (node, value, key) &#123;</span><br><span class="line">    node.textContent = value</span><br><span class="line">    <span class="keyword">new</span> Watcher(<span class="built_in">this</span>.vm, key, <span class="function">(<span class="params">newValue</span>) =&gt;</span> &#123;</span><br><span class="line">      node.textContent = newValue</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// v-model</span></span><br><span class="line">  modelUpdater (node, value, key) &#123;</span><br><span class="line">    node.value = value</span><br><span class="line">    <span class="keyword">new</span> Watcher(<span class="built_in">this</span>.vm, key, <span class="function">(<span class="params">newValue</span>) =&gt;</span> &#123;</span><br><span class="line">      node.value = newValue</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="comment">// 双向绑定</span></span><br><span class="line">    node.addEventListener(<span class="string">&#x27;input&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.vm[key] = node.value</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// v-html</span></span><br><span class="line">  htmlUpdater (node, value, key) &#123;</span><br><span class="line">    node.innerHTML = value</span><br><span class="line">    <span class="keyword">new</span> Watcher(<span class="built_in">this</span>.vm, key, <span class="function">(<span class="params">newValue</span>) =&gt;</span> &#123;</span><br><span class="line">      node.innerHTML = newValue</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// v-on</span></span><br><span class="line">  onUpdater (node, value, key) &#123;</span><br><span class="line">    <span class="keyword">if</span> (key === <span class="string">&quot;click&quot;</span>) &#123;</span><br><span class="line">      node.onclick = value</span><br><span class="line">      <span class="keyword">new</span> Watcher(<span class="built_in">this</span>.methods, key, <span class="function">(<span class="params">newValue</span>) =&gt;</span> &#123;</span><br><span class="line">        node.onclick = newValue</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 编译文本节点，处理差值表达式</span></span><br><span class="line">  compileText (node) &#123;</span><br><span class="line">    <span class="comment">// console.dir(node)</span></span><br><span class="line">    <span class="comment">// &#123;&#123;  msg &#125;&#125;</span></span><br><span class="line">    <span class="keyword">let</span> reg = <span class="regexp">/\&#123;\&#123;(.+?)\&#125;\&#125;/</span></span><br><span class="line">    <span class="keyword">let</span> value = node.textContent</span><br><span class="line">    <span class="keyword">if</span> (reg.test(value)) &#123;</span><br><span class="line">      <span class="keyword">let</span> key = <span class="built_in">RegExp</span>.$1.trim()</span><br><span class="line">      node.textContent = value.replace(reg, <span class="built_in">this</span>.vm[key])</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 创建watcher对象，当数据改变更新视图</span></span><br><span class="line">      <span class="keyword">new</span> Watcher(<span class="built_in">this</span>.vm, key, <span class="function">(<span class="params">newValue</span>) =&gt;</span> &#123;</span><br><span class="line">        node.textContent = newValue</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 判断元素属性是否是指令</span></span><br><span class="line">  isDirective (attrName) &#123;</span><br><span class="line">    <span class="keyword">return</span> attrName.startsWith(<span class="string">&#x27;v-&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 判断节点是否是文本节点</span></span><br><span class="line">  isTextNode (node) &#123;</span><br><span class="line">    <span class="keyword">return</span> node.nodeType === <span class="number">3</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 判断节点是否是元素节点</span></span><br><span class="line">  isElementNode (node) &#123;</span><br><span class="line">    <span class="keyword">return</span> node.nodeType === <span class="number">1</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>observe.js</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Observer</span> </span>&#123;</span><br><span class="line">  <span class="title">constructor</span> (<span class="params">data</span>) &#123;</span><br><span class="line">    <span class="built_in">this</span>.walk(data)</span><br><span class="line">  &#125;</span><br><span class="line">  walk (data) &#123;</span><br><span class="line">    <span class="comment">// 1. 判断data是否是对象</span></span><br><span class="line">    <span class="keyword">if</span> (!data || <span class="keyword">typeof</span> data !== <span class="string">&#x27;object&#x27;</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 2. 遍历data对象的所有属性</span></span><br><span class="line">    <span class="built_in">Object</span>.keys(data).forEach(<span class="function"><span class="params">key</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.defineReactive(data, key, data[key])</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  defineReactive (obj, key, val) &#123;</span><br><span class="line">    <span class="keyword">let</span> that = <span class="built_in">this</span></span><br><span class="line">    <span class="comment">// 负责收集依赖，并发送通知</span></span><br><span class="line">    <span class="keyword">let</span> dep = <span class="keyword">new</span> Dep()</span><br><span class="line">    <span class="comment">// 如果val是对象，把val内部的属性转换成响应式数据</span></span><br><span class="line">    <span class="built_in">this</span>.walk(val)</span><br><span class="line">    <span class="built_in">Object</span>.defineProperty(obj, key, &#123;</span><br><span class="line">      <span class="attr">enumerable</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">configurable</span>: <span class="literal">true</span>,</span><br><span class="line">      get () &#123;</span><br><span class="line">        <span class="comment">// 收集依赖</span></span><br><span class="line">        Dep.target &amp;&amp; dep.addSub(Dep.target)</span><br><span class="line">        <span class="keyword">return</span> val</span><br><span class="line">      &#125;,</span><br><span class="line">      set (newValue) &#123;</span><br><span class="line">        <span class="keyword">if</span> (newValue === val) &#123;</span><br><span class="line">          <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        val = newValue</span><br><span class="line">        that.walk(newValue)</span><br><span class="line">        <span class="comment">// 发送通知</span></span><br><span class="line">        dep.notify()</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>vue.js</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Vue</span> </span>&#123;</span><br><span class="line">  <span class="title">constructor</span> (<span class="params">options</span>) &#123;</span><br><span class="line">    <span class="comment">// 1. 通过属性保存选项的数据</span></span><br><span class="line">    <span class="built_in">this</span>.$options = options || &#123;&#125;</span><br><span class="line">    <span class="built_in">this</span>.$data = options.data || &#123;&#125;</span><br><span class="line">    <span class="built_in">this</span>.$methods = options.methods || &#123;&#125;</span><br><span class="line">    <span class="built_in">this</span>.$el = <span class="keyword">typeof</span> options.el === <span class="string">&#x27;string&#x27;</span> ? <span class="built_in">document</span>.querySelector(options.el) : options.el</span><br><span class="line">    <span class="comment">// 2. 把data中的成员转换成getter和setter，注入到vue实例中</span></span><br><span class="line">    <span class="built_in">this</span>._proxyData(<span class="built_in">this</span>.$data)</span><br><span class="line">    <span class="comment">// 3. 调用observer对象，监听数据的变化</span></span><br><span class="line">    <span class="keyword">new</span> Observer(<span class="built_in">this</span>.$data)</span><br><span class="line">    <span class="comment">// 4. 调用compiler对象，解析指令和差值表达式</span></span><br><span class="line">    <span class="keyword">new</span> Compiler(<span class="built_in">this</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  _proxyData (data) &#123;</span><br><span class="line">    <span class="comment">// 遍历data中的所有属性</span></span><br><span class="line">    <span class="built_in">Object</span>.keys(data).forEach(<span class="function"><span class="params">key</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 把data的属性注入到vue实例中</span></span><br><span class="line">      <span class="built_in">Object</span>.defineProperty(<span class="built_in">this</span>, key, &#123;</span><br><span class="line">        <span class="attr">enumerable</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">configurable</span>: <span class="literal">true</span>,</span><br><span class="line">        get () &#123;</span><br><span class="line">          <span class="keyword">return</span> data[key]</span><br><span class="line">        &#125;,</span><br><span class="line">        set (newValue) &#123;</span><br><span class="line">          <span class="keyword">if</span> (newValue === data[key]) &#123;</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">          &#125;</span><br><span class="line">          data[key] = newValue</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="写在最后"><a href="#写在最后" class="headerlink" title="写在最后"></a>写在最后</h4><p>原创博文, 如有错误, 敬请指导!</p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/vue/" rel="tag">vue</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%8F%91%E5%B8%83%E8%AE%A2%E9%98%85%E6%A8%A1%E5%BC%8F/" rel="tag">发布订阅模式</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%93%8D%E5%BA%94%E5%BC%8F%E5%8E%9F%E7%90%86/" rel="tag">响应式原理</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F/" rel="tag">观察者模式</a></li></ul>

    </footer>
  </div>

    
 
    
</article>

    
    <article
  id="post-fdjl"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2021/09/03/fdjl/"
    >实现防抖和节流的函数</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2021/09/03/fdjl/" class="article-date">
  <time datetime="2021-09-03T06:33:14.000Z" itemprop="datePublished">2021-09-03</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%89%8D%E7%AB%AF%E8%BF%9B%E9%98%B6%E7%AC%94%E8%AE%B0/">前端进阶笔记</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h5 id="我们为什么需要防抖和节流："><a href="#我们为什么需要防抖和节流：" class="headerlink" title="我们为什么需要防抖和节流："></a>我们为什么需要防抖和节流：</h5><p>浏览器默认情况下都会有自己的监听事件间隔（ 4~6ms)，如果检测到多次事件的监听执行，那么就会造成不必要的资源浪费<br>在一些高频率事件触发的场景下我们不希望对应的事件处理函数多次执行<br>比如以下场景:</p>
<ul>
<li>滚动事件</li>
<li>输入的模糊匹配</li>
<li>轮播图切换</li>
<li>点击操作</li>
<li>….</li>
</ul>
<p>前置的场景： 界面上有一个按钮，我们可以连续多次点击</p>
<p>防抖：对于这个高频的操作来说，我们只希望识别一次点击，可以人为是第一次或者是最后一次<br>节流：对于高频操作，我们可以自己来设置频率，让本来会执行很多次的事件触发，按着我们定义的频率减少触发的次数</p>
<h5 id="实现一个防抖函数"><a href="#实现一个防抖函数" class="headerlink" title="实现一个防抖函数"></a>实现一个防抖函数</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>防抖函数实现<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">&quot;btn&quot;</span>&gt;</span>点击<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> oBtn = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;btn&#x27;</span>)</span></span><br><span class="line"><span class="javascript">    <span class="comment">// oBtn.onclick = function () &#123;</span></span></span><br><span class="line"><span class="javascript">    <span class="comment">//   console.log(&#x27;点击了&#x27;)</span></span></span><br><span class="line"><span class="javascript">    <span class="comment">// &#125;</span></span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">    <span class="comment">/** </span></span></span><br><span class="line"><span class="comment"><span class="javascript">     * handle 最终需要执行的事件监听</span></span></span><br><span class="line"><span class="comment"><span class="javascript">     * wait 事件触发之后多久开始执行</span></span></span><br><span class="line"><span class="comment"><span class="javascript">     * immediate 控制执行第一次还是最后一次，false 执行最后一次</span></span></span><br><span class="line"><span class="comment"><span class="javascript">    */</span></span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">myDebounce</span>(<span class="params">handle, wait, immediate</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">      <span class="comment">// 参数类型判断及默认值处理</span></span></span><br><span class="line"><span class="javascript">      <span class="keyword">if</span> (<span class="keyword">typeof</span> handle !== <span class="string">&#x27;function&#x27;</span>) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&#x27;handle must be an function&#x27;</span>)</span></span><br><span class="line"><span class="javascript">      <span class="keyword">if</span> (<span class="keyword">typeof</span> wait === <span class="string">&#x27;undefined&#x27;</span>) wait = <span class="number">300</span></span></span><br><span class="line"><span class="javascript">      <span class="keyword">if</span> (<span class="keyword">typeof</span> wait === <span class="string">&#x27;boolean&#x27;</span>) &#123;</span></span><br><span class="line"><span class="javascript">        immediate = wait</span></span><br><span class="line"><span class="javascript">        wait = <span class="number">300</span></span></span><br><span class="line"><span class="javascript">      &#125;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">if</span> (<span class="keyword">typeof</span> immediate !== <span class="string">&#x27;boolean&#x27;</span>) immediate = <span class="literal">false</span></span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">      <span class="comment">// 所谓的防抖效果我们想要实现的就是有一个 ”人“ 可以管理 handle 的执行次数</span></span></span><br><span class="line"><span class="javascript">      <span class="comment">// 如果我们想要执行最后一次，那就意味着无论我们当前点击了多少次，前面的N-1次都无用</span></span></span><br><span class="line"><span class="javascript">      <span class="keyword">let</span> timer = <span class="literal">null</span></span></span><br><span class="line"><span class="javascript">      <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="title">proxy</span>(<span class="params">...args</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">let</span> self = <span class="built_in">this</span>,</span></span><br><span class="line"><span class="javascript">          init = immediate &amp;&amp; !timer</span></span><br><span class="line"><span class="javascript">        <span class="built_in">clearTimeout</span>(timer)</span></span><br><span class="line"><span class="javascript">        timer = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">          timer = <span class="literal">null</span></span></span><br><span class="line"><span class="javascript">          !immediate ? handle.call(self, ...args) : <span class="literal">null</span></span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(self)</span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(...args)</span></span><br><span class="line"><span class="javascript">        &#125;, wait)</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        <span class="comment">// 如果当前传递进来的是 true 就表示我们需要立即执行</span></span></span><br><span class="line"><span class="javascript">        <span class="comment">// 如果想要实现只在第一次执行，那么可以添加上 timer 为 null 做为判断</span></span></span><br><span class="line"><span class="javascript">        <span class="comment">// 因为只要 timer 为 Null 就意味着没有第二次....点击</span></span></span><br><span class="line"><span class="javascript">        init ? handle.call(self, ...args) : <span class="literal">null</span></span></span><br><span class="line"><span class="javascript">      &#125;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">    &#125;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">    <span class="comment">// 定义事件执行函数</span></span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">btnClick</span>(<span class="params">ev</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="built_in">this</span>)</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="string">&#x27;点击了1111&#x27;</span>, <span class="built_in">this</span>, ev)</span></span><br><span class="line"><span class="javascript">    &#125;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">    <span class="comment">// 当我们执行了按钮点击之后就会执行...返回的 proxy</span></span></span><br><span class="line"><span class="javascript">    oBtn.onclick = myDebounce(btnClick, <span class="number">200</span>, <span class="literal">false</span>)</span></span><br><span class="line"><span class="javascript">    <span class="comment">// oBtn.onclick = btnClick()  // this ev</span></span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>


<h5 id="实现一个节流函数"><a href="#实现一个节流函数" class="headerlink" title="实现一个节流函数"></a>实现一个节流函数</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>节流函数实现<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="css"></span></span><br><span class="line"><span class="css">    <span class="selector-tag">body</span> &#123;</span></span><br><span class="line"><span class="css">      <span class="attribute">height</span>: <span class="number">5000px</span>;</span></span><br><span class="line"><span class="css">    &#125;</span></span><br><span class="line"><span class="css">  </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">    <span class="comment">// 节流：我们这里的节流指的就是在自定义的一段时间内让事件进行触发</span></span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">myThrottle</span>(<span class="params">handle, wait</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">if</span> (<span class="keyword">typeof</span> handle !== <span class="string">&#x27;function&#x27;</span>) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&#x27;handle must be an function&#x27;</span>)</span></span><br><span class="line"><span class="javascript">      <span class="keyword">if</span> (<span class="keyword">typeof</span> wait === <span class="string">&#x27;undefined&#x27;</span>) wait = <span class="number">400</span></span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">      <span class="keyword">let</span> previous = <span class="number">0</span>  <span class="comment">// 定义变量记录上一次执行时的时间 </span></span></span><br><span class="line"><span class="javascript">      <span class="keyword">let</span> timer = <span class="literal">null</span>  <span class="comment">// 用它来管理定时器</span></span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">      <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="title">proxy</span>(<span class="params">...args</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">let</span> now = <span class="keyword">new</span> <span class="built_in">Date</span>() <span class="comment">// 定义变量记录当前次执行的时刻时间点</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">let</span> self = <span class="built_in">this</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">let</span> interval = wait - (now - previous)</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">        <span class="keyword">if</span> (interval &lt;= <span class="number">0</span>) &#123;</span></span><br><span class="line"><span class="javascript">          <span class="comment">// 此时就说明是一个非高频次操作，可以执行 handle </span></span></span><br><span class="line"><span class="javascript">          <span class="built_in">clearTimeout</span>(timer)</span></span><br><span class="line"><span class="javascript">          timer = <span class="literal">null</span></span></span><br><span class="line"><span class="javascript">          handle.call(self, ...args)</span></span><br><span class="line"><span class="javascript">          previous = <span class="keyword">new</span> <span class="built_in">Date</span>()</span></span><br><span class="line"><span class="javascript">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!timer) &#123;</span></span><br><span class="line"><span class="javascript">          <span class="comment">// 当我们发现当前系统中有一个定时器了，就意味着我们不需要再开启定时器</span></span></span><br><span class="line"><span class="javascript">          <span class="comment">// 此时就说明这次的操作发生在了我们定义的频次时间范围内，那就不应该执行 handle</span></span></span><br><span class="line"><span class="javascript">          <span class="comment">// 这个时候我们就可以自定义一个定时器，让 handle 在 interval 之后去执行 </span></span></span><br><span class="line"><span class="javascript">          timer = <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">            <span class="built_in">clearTimeout</span>(timer) <span class="comment">// 这个操作只是将系统中的定时器清除了，但是 timer 中的值还在</span></span></span><br><span class="line"><span class="javascript">            timer = <span class="literal">null</span></span></span><br><span class="line"><span class="javascript">            handle.call(self, ...args)</span></span><br><span class="line"><span class="javascript">            previous = <span class="keyword">new</span> <span class="built_in">Date</span>()</span></span><br><span class="line"><span class="javascript">          &#125;, interval)</span></span><br><span class="line"><span class="javascript">        &#125;</span></span><br><span class="line"><span class="javascript">      &#125;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">    &#125;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">    <span class="comment">// 定义滚动事件监听</span></span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">scrollFn</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">      <span class="built_in">console</span>.log(<span class="string">&#x27;滚动了&#x27;</span>)</span></span><br><span class="line"><span class="javascript">    &#125;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">    <span class="comment">// window.onscroll = scrollFn</span></span></span><br><span class="line"><span class="javascript">    <span class="built_in">window</span>.onscroll = myThrottle(scrollFn, <span class="number">600</span>)</span></span><br><span class="line"><span class="javascript">  </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/" rel="tag">内存管理</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/" rel="tag">性能优化</a></li></ul>

    </footer>
  </div>

    
 
    
</article>

    
    <article
  id="post-813problem"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2021/08/20/813problem/"
    >关于8月13日Github改版,hexo受到影响的总结</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2021/08/20/813problem/" class="article-date">
  <time datetime="2021-08-20T02:31:18.000Z" itemprop="datePublished">2021-08-20</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%89%8D%E7%AB%AF%E8%BF%9B%E9%98%B6%E7%AC%94%E8%AE%B0/">前端进阶笔记</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <p>关于8月13日Github改版,hexo受到影响的总结</p>
<p>众所周知,2021年8月13日Github的改版影响了不少项目,Github以密码不安全为由建议用户改用秘钥.</p>
<p>当时的提交报错为:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">remote: Support <span class="keyword">for</span> password authentication was removed on August <span class="number">13</span>, <span class="number">2021.</span> Please use a personal access token instead.</span><br></pre></td></tr></table></figure>
<p>这个问题其实很好解决,网上有很多人分享了解决过程,解决完上述报错,一般还会引起一系列报错,国内网络上都有很多人分享解决办法,这里不多赘述.<br>参考<a target="_blank" rel="noopener" href="https://www.codepeople.cn/2021/09/02/github-problem/">https://www.codepeople.cn/2021/09/02/github-problem/</a></p>
<p>但是修改之后hexo编译后也是犹豫8.13的问题同步不到github.io上面去,怎么办呢</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">ssh -T git@github.com<span class="comment">//验证key 如果验证失败执行下列命令</span></span><br><span class="line">ssh-keygen -t rsa -C <span class="string">&quot;xxx@qq.com&quot;</span><span class="comment">//一路回车即可</span></span><br><span class="line">ssh -v git@github.com</span><br><span class="line"><span class="comment">//　　最后两句会出现：</span></span><br><span class="line"><span class="comment">//　　No more authentication methods to try.</span></span><br><span class="line"><span class="comment">//　　Permission denied (publickey).</span></span><br><span class="line"><span class="comment">//　　这时候再输入</span></span><br><span class="line">ssh-agent -s</span><br><span class="line"><span class="comment">/*然后会提示类似的信息：　　</span></span><br><span class="line"><span class="comment">SSH_AUTH_SOCK=/tmp/ssh-GTpABX1a05qH/agent.404; export SSH_AUTH_SOCK;  　　</span></span><br><span class="line"><span class="comment">SSH_AGENT_PID=13144; export SSH_AGENT_PID;  　　</span></span><br><span class="line"><span class="comment">echo Agent pid 13144;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">ssh-add ~<span class="regexp">/.ssh/i</span>d_rsa</span><br><span class="line"><span class="comment">/*这时候应该会提示：　　Identity added: ...（这里是一些ssh key文件路径的信息）　　</span></span><br><span class="line"><span class="comment">（注意）如果出现错误提示：　　Could not open a connection to your authentication agent.　　</span></span><br><span class="line"><span class="comment">请执行命令：eval `ssh-agent -s`后继续执行命令 ssh-add ~/.ssh/id_rsa，这时候一般没问题啦。</span></span><br><span class="line"><span class="comment">将里面的内容复制，进入你的github账号，在settings下，SSH and GPG keys下new SSH key，</span></span><br><span class="line"><span class="comment">title随便取一个名字，然后将id_rsa.pub里的内容复制到Key中，完成后Add SSH Key。</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">ssh -T git@github.com</span><br><span class="line"><span class="comment">/*提示：Hi xxx! You&#x27;ve successfully authenticated, but GitHub does not provide shell access.</span></span><br><span class="line"><span class="comment">　　这时候你的问题就解决啦</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure> 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%85%B6%E4%BB%96/" rel="tag">其他</a></li></ul>

    </footer>
  </div>

    
 
    
</article>

    
    <article
  id="post-snabbdom"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2021/07/15/snabbdom/"
    >snabbdom</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2021/07/15/snabbdom/" class="article-date">
  <time datetime="2021-07-15T07:37:29.000Z" itemprop="datePublished">2021-07-15</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%89%8D%E7%AB%AF%E8%BF%9B%E9%98%B6%E7%AC%94%E8%AE%B0/">前端进阶笔记</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <p>mkdir snabdom-demo</p>
<p>cd snabdom-demo</p>
<p>//创建package</p>
<p>npm init -y</p>
<p>//本地安装parcel</p>
<p>npm install parcel-bundler -D</p>
<p>配置scripts</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;scripts&quot;</span> :&#123;</span><br><span class="line"><span class="string">&quot;dev&quot;</span> :<span class="string">&quot;parcel index.html -- open&quot;</span>,</span><br><span class="line"><span class="string">&quot;build&quot;</span>: <span class="string">&quot;parcel build index.html&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在根目录创建index.html文件  来引入</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;./src/01-basicusage.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>npm install <a href="mailto:&#115;&#x6e;&#97;&#x62;&#98;&#x64;&#x6f;&#x6d;&#x40;&#50;&#46;&#x31;&#x2e;&#48;">&#115;&#x6e;&#97;&#x62;&#98;&#x64;&#x6f;&#x6d;&#x40;&#50;&#46;&#x31;&#x2e;&#48;</a></p>
<p>h(‘!’) //这是 一个空的节点</p>
<h4 id="snabbdom模块的使用"><a href="#snabbdom模块的使用" class="headerlink" title="snabbdom模块的使用"></a>snabbdom模块的使用</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. 导入模块</span></span><br><span class="line"><span class="keyword">import</span> &#123; styleModule &#125; <span class="keyword">from</span> <span class="string">&#x27;snabbdom/build/package/modules/style&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; eventListenersModule &#125; <span class="keyword">from</span> <span class="string">&#x27;snabbdom/build/package/modules/eventlisteners&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 注册模块</span></span><br><span class="line"><span class="keyword">const</span> patch = init([</span><br><span class="line">  styleModule,</span><br><span class="line">  eventListenersModule</span><br><span class="line">])</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 使用h() 函数的第二个参数传入模块中使用的数据（对象）</span></span><br><span class="line"><span class="keyword">let</span> vnode = h(<span class="string">&#x27;div&#x27;</span>, [</span><br><span class="line">  h(<span class="string">&#x27;h1&#x27;</span>, &#123; <span class="attr">style</span>: &#123; <span class="attr">backgroundColor</span>: <span class="string">&#x27;red&#x27;</span> &#125; &#125;, <span class="string">&#x27;Hello World&#x27;</span>),</span><br><span class="line">  h(<span class="string">&#x27;p&#x27;</span>, &#123; <span class="attr">on</span>: &#123; <span class="attr">click</span>: eventHandler &#125; &#125;, <span class="string">&#x27;Hello P&#x27;</span>)</span><br><span class="line">])</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">eventHandler</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;别点我，疼&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> app = <span class="built_in">document</span>.querySelector(<span class="string">&#x27;#app&#x27;</span>)</span><br><span class="line"><span class="comment">// 生成虚拟dom 根据diff算法更新dom</span></span><br><span class="line">patch(app, vnode)</span><br></pre></td></tr></table></figure>


<p>snabbdom源码学习</p>
<p>snabbdom源码地址</p>
<p><a target="_blank" rel="noopener" href="https://github.com/snabbdom/snabbdom">https://github.com/snabbdom/snabbdom</a></p>
<p>Snabbdom的核心<br>init() 设置模块，创建patch()函数<br>使用h()函数创建JavaScript对象(VNode)描述真实DOM<br>patch()比较新旧两个Vnode<br>把变化的内容更新到真实DOM树</p>
<h4 id="一个简单的例子"><a href="#一个简单的例子" class="headerlink" title="一个简单的例子"></a>一个简单的例子</h4><p>总体代码在<a target="_blank" rel="noopener" href="https://github.com/Levxn7/lagouhomework/tree/master/part3/fed-e-task-03-01/third">https://github.com/Levxn7/lagouhomework/tree/master/part3/fed-e-task-03-01/third</a></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; init &#125; <span class="keyword">from</span> <span class="string">&#x27;snabbdom/build/package/init&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; h &#125; <span class="keyword">from</span> <span class="string">&#x27;snabbdom/build/package/h&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; styleModule &#125; <span class="keyword">from</span> <span class="string">&#x27;snabbdom/build/package/modules/style&#x27;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; eventListenersModule &#125; <span class="keyword">from</span> <span class="string">&#x27;snabbdom/build/package/modules/eventlisteners&#x27;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> patch = init([styleModule, eventListenersModule]);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> vnode;</span><br><span class="line"><span class="keyword">let</span> sortBy = <span class="string">&quot;rank&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> data = []</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">  <span class="keyword">let</span> a = &#123;</span><br><span class="line">    <span class="attr">rank</span>: i,</span><br><span class="line">    <span class="attr">title</span>: <span class="string">&#x27;title&#x27;</span> + i,</span><br><span class="line">    <span class="attr">desc</span>: <span class="string">&#x27;this is desc&#x27;</span> + i</span><br><span class="line">  &#125;</span><br><span class="line">  data.push(a)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">change</span>(<span class="params">prop</span>) </span>&#123;</span><br><span class="line">  data.sort(<span class="function">(<span class="params">a, b</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (a[prop] &gt; b[prop]) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (a[prop] &lt; b[prop]) &#123;</span><br><span class="line">      <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  vnode = patch(vnode, view(data));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> a = &#123;</span><br><span class="line">    <span class="attr">rank</span>: data.length,</span><br><span class="line">    <span class="attr">title</span>: <span class="string">&#x27;title&#x27;</span> + data.length,</span><br><span class="line">    <span class="attr">desc</span>: <span class="string">&#x27;this is desc&#x27;</span> + data.length</span><br><span class="line">  &#125;</span><br><span class="line">  data.unshift(a)</span><br><span class="line">  vnode = patch(vnode, view(data));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">remove</span>(<span class="params">index</span>) </span>&#123;</span><br><span class="line">  data.splice(index, <span class="number">1</span>)</span><br><span class="line">  vnode = patch(vnode, view(data));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">movieView</span>(<span class="params">movie,index</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> h(</span><br><span class="line">    <span class="string">&quot;div.li&quot;</span>,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">key</span>: movie.rank,</span><br><span class="line">      <span class="attr">style</span>: &#123;</span><br><span class="line">        <span class="attr">padding</span>: <span class="string">&#x27;0 16px&#x27;</span>,</span><br><span class="line">        <span class="attr">height</span>: <span class="string">&#x27;50px&#x27;</span>,</span><br><span class="line">        <span class="attr">display</span>: <span class="string">&#x27;flex&#x27;</span>,</span><br><span class="line">        <span class="attr">alignItems</span>: <span class="string">&#x27;center&#x27;</span>,</span><br><span class="line">        <span class="attr">borderBottom</span>: <span class="string">&#x27;1px solid #ccc&#x27;</span>,</span><br><span class="line">        <span class="attr">justifyContent</span>: <span class="string">&#x27;space-between&#x27;</span>,</span><br><span class="line">        <span class="attr">opacity</span>: <span class="string">&#x27;0&#x27;</span>,</span><br><span class="line">        <span class="attr">delayed</span>: &#123; <span class="attr">transition</span>: <span class="string">&#x27;opacity 2s&#x27;</span>, <span class="attr">opacity</span>: <span class="string">&#x27;1&#x27;</span> &#125;,</span><br><span class="line">        <span class="attr">remove</span>: &#123; <span class="attr">transition</span>: <span class="string">&#x27;opacity 0.3s&#x27;</span>, <span class="attr">opacity</span>: <span class="string">&#x27;0&#x27;</span> &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    [</span><br><span class="line">      h(<span class="string">&quot;div&quot;</span>, &#123; <span class="attr">style</span>: &#123; <span class="attr">fontWeight</span>: <span class="string">&quot;bold&quot;</span> &#125; &#125;, movie.rank),</span><br><span class="line">      h(<span class="string">&quot;div&quot;</span>, movie.title),</span><br><span class="line">      h(<span class="string">&quot;div&quot;</span>, movie.desc),</span><br><span class="line">      h(</span><br><span class="line">        <span class="string">&quot;button.btn.rm-btn&quot;</span>,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">on</span>: &#123;</span><br><span class="line">            <span class="attr">click</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">              remove(index);</span><br><span class="line">            &#125;,</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;删除&quot;</span></span><br><span class="line">      ),</span><br><span class="line">    ]</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">view</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> h(<span class="string">&quot;div&quot;</span>, [</span><br><span class="line">    h(<span class="string">&quot;h1&quot;</span>, <span class="string">&quot;Top 10 movies&quot;</span>),</span><br><span class="line">    h(<span class="string">&quot;div&quot;</span>, [</span><br><span class="line">      h(<span class="string">&quot;button.add&quot;</span>, &#123; <span class="attr">on</span>: &#123; <span class="attr">click</span>: add &#125; &#125;, <span class="string">&quot; 添加 &quot;</span>),</span><br><span class="line">      <span class="string">&quot;排序方式: &quot;</span>,</span><br><span class="line">      h(<span class="string">&quot;span.btn-group&quot;</span>, [</span><br><span class="line">        h(</span><br><span class="line">          <span class="string">&quot;button.rank&quot;</span>,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">class</span>: &#123; <span class="attr">active</span>: sortBy === <span class="string">&quot;rank&quot;</span> &#125;,</span><br><span class="line">            <span class="attr">on</span>: &#123;</span><br><span class="line">              <span class="attr">click</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">                change(<span class="string">&quot;rank&quot;</span>);</span><br><span class="line">              &#125;,</span><br><span class="line">            &#125;,</span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="string">&quot; Rank &quot;</span></span><br><span class="line">        ),</span><br><span class="line">        h(</span><br><span class="line">          <span class="string">&quot;button.title&quot;</span>,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">class</span>: &#123; <span class="attr">active</span>: sortBy === <span class="string">&quot;title&quot;</span> &#125;,</span><br><span class="line">            <span class="attr">on</span>: &#123;</span><br><span class="line">              <span class="attr">click</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">                change(<span class="string">&quot;title&quot;</span>);</span><br><span class="line">              &#125;,</span><br><span class="line">            &#125;,</span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="string">&quot; Title &quot;</span></span><br><span class="line">        ),</span><br><span class="line">        h(</span><br><span class="line">          <span class="string">&quot;button.desc&quot;</span>,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">class</span>: &#123; <span class="attr">active</span>: sortBy === <span class="string">&quot;desc&quot;</span> &#125;,</span><br><span class="line">            <span class="attr">on</span>: &#123;</span><br><span class="line">              <span class="attr">click</span>: <span class="function">() =&gt;</span> &#123;</span><br><span class="line">                change(<span class="string">&quot;desc&quot;</span>);</span><br><span class="line">              &#125;,</span><br><span class="line">            &#125;,</span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="string">&quot; Description &quot;</span></span><br><span class="line">        ),</span><br><span class="line">      ]),</span><br><span class="line">    ]),</span><br><span class="line">    h(</span><br><span class="line">      <span class="string">&quot;div.list&quot;</span>,</span><br><span class="line">      &#123; <span class="attr">style</span>: &#123; <span class="attr">height</span>: <span class="string">&quot;8px&quot;</span> &#125; &#125;,</span><br><span class="line">      data.map(movieView)</span><br><span class="line">    ),</span><br><span class="line">  ]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> addEl = <span class="built_in">document</span>.querySelector(<span class="string">&#x27;#app&#x27;</span>);</span><br><span class="line">vnode = patch(addEl, view(data));</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="写在最后"><a href="#写在最后" class="headerlink" title="写在最后"></a>写在最后</h4><p>原创博文, 如有错误, 敬请指导!</p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/snabbdom/" rel="tag">snabbdom</a></li></ul>

    </footer>
  </div>

    
 
    
</article>

    
    <article
  id="post-vuecode"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h2 itemprop="name">
  <a class="article-title" href="/2021/07/12/vuecode/"
    >vue源码琐碎知识点</a> 
</h2>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2021/07/12/vuecode/" class="article-date">
  <time datetime="2021-07-12T06:20:26.000Z" itemprop="datePublished">2021-07-12</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%89%8D%E7%AB%AF%E8%BF%9B%E9%98%B6%E7%AC%94%E8%AE%B0/">前端进阶笔记</a>
  </div>
   
    </div>
      
    <div class="article-entry" itemprop="articleBody">
       
  <h4 id="一些零碎的知识"><a href="#一些零碎的知识" class="headerlink" title="一些零碎的知识"></a>一些零碎的知识</h4><p>flow是js的静态类型检查器，但vue3以后是用ts检查的</p>
<p>vue的打包工具是rollup，rollup更适合库打包</p>
<p>调试需要开启sourcemap</p>
<p>js文件中的flow语法检查红线报错问题：setting。json中设置为false就能解决<br>泛型导致高亮显示失效问题，安装插件 babel-JavaScript可以解决</p>
<p>with函数的扩展</p>
<p>vue Template Explorer网页工具，把html代码转换为模板编译后的代码</p>
<p>静态成员 initGlobalAPI（core/index.js）<br>初始化vue.config util set selete nextTick等</p>
<p>初始化vue.options并给其扩展components directives filters</p>
<h5 id="初始化的过程"><a href="#初始化的过程" class="headerlink" title="初始化的过程"></a>初始化的过程</h5><p>实例成员<br>//注册 vm 的init() 方法，初始化Vm<br>initMixin(Vue)<br>// 注册 vm 的 $data/ $props/ $set/ $delete/ $watch<br>stateMixin(Vue)<br>//初始化事件相关方法<br>// $on/$once/$off/$emit<br>eventsMixin(Vue)<br>//初始化生命周期相关的混入方法<br>// _update/$forceUpdate/ $destroy<br>lifecycleMixin(Vue)<br>// 混入 render<br>// $nextTick/_render<br>renderMixin(Vue)</p>
<p>init函数 初始化<br>是分模块实现的</p>
<h5 id="Vue-首次渲染的过程。"><a href="#Vue-首次渲染的过程。" class="headerlink" title="Vue 首次渲染的过程。"></a>Vue 首次渲染的过程。</h5><p>在首次渲染之前，先进行vue的初始化，初始化实例成员，静态成员，当初始化结束后调用vue的构造函数，在构造函数中调用了init方法，这个方法相当于整个文件的入口<br>方法中调用了$mount<br>第一个$mount通过compileToFunction帮我们把模板编译成render函数，存入options.render中<br>第二个$mount中重新获取$el<br>调用mountComponent，先判断是否是render选项，如果没有，但是传入的是模板并且是运行版本时，版本会被警告不支持编译器<br>触发beforemount，定义updateComponent，调用render生成虚拟dom和update方法将虚拟dom转换成真实dom并挂载到页面上来<br>创建watcher对象，传入了updateComponent函数，在watcher中调用，调用的get方法<br>创建完watcher会调用一个get方法，在get中调用updateComponent，updateComponent中会调用render和update两个方法<br>render的作用是创建虚拟dom，最终调用的用户传入的或者模板编译的render<br>返回vnode，调用vm._update，在其中调用__patch__ 这个方法将虚拟dom转换成真实dom并挂载到页面上来，真实dom渲染到$el中<br>触发mounted 挂载结束 返回vue实例</p>
<h4 id="响应式原理"><a href="#响应式原理" class="headerlink" title="响应式原理"></a>响应式原理</h4><p>处理的入口<br>observe就是响应式处理的入口，调用了Observer对象<br>Observer是一个类 使用的flow的语法<br>defineReactive</p>
<p>Watcher 分为三种，Computed Watcher、用户 Watcher (侦听器)、渲染Watcher<br>instance/lifecycle.js</p>
<h5 id="Vue-响应式原理。"><a href="#Vue-响应式原理。" class="headerlink" title="Vue 响应式原理。"></a>Vue 响应式原理。</h5><p>响应式是从vue实例的init方法开始的，在init方法中先调用initState()方法初始化vue实例的状态<br>在其中调用了initData，这个方法是把data属性注入到vue实例上，并且调用observe把data对象转换成响应式的对象，observe就是响应式的入口<br>observe接受一个参数，这个参数就是响应式要处理的对象，observe在src/corelobserver/index.js中，先判断value是否是对象，如果不是对象就直接返回<br>然后判断value对象是否有__ob__属性，,如果有就说明这个对象已经做过响应式处理，直接返回，如果没有，就创建observer对象，返回observer 对象<br>Observe类会给value对象定义一个不可枚举的__ob__属性，并把这个属性记录到当前的observer中，然后给对象做响应式处理<br>数组的处理就是设置几个特殊的方法，方法会改变数组，会发送通知，找到dep方法调用，遍历成员，调用observe<br>对象的处理会调用walk方法，遍历对象，给每个属性调用defineReactive方法<br>defineReactive会给每个属性创建dep对象，让dep去收集依赖，如果当前属性是对象，就调用observe，要把这个对象变成响应式<br>定义getter收集依赖，包括对象的子对象<br>定义setter保存新值，如果新值是对象，就调用observe，发送通知，调用dep.notify<br>依赖收集：首先执行watcher对象中的get方法，调用pushTarget把watcher对象记录到dep.target属性中<br>在访问data中的成员的时候收集依赖，触发defineReactive中的getter收集依赖，把属性对应的watcher对象添加到dep的subs数组中，也就是为属性收集依赖，如果属性的值是个对象，就创建一个childOb收集依赖，目的是子对象添加和删除成员时发送通知<br>watcher：当数据发生变化的时候通过dep.notify发送通知，他会调用watcher对象的update方法，在update方法中会调用queueWatcher函数，来判断watcher是否被处理了，如果没有就添加到queue队列，并调用flushSchedulerQueue刷新队列<br>flushSchedulerQueue会触发beforeUpdata钩子函数，然后调用watcher.run函数，在其中调用run–&gt;get–&gt;getter–&gt;updateComponent<br>调用run方法之后，就可以在页面上看到数据了<br>清空上一次的依赖，重置watcher的状态，然后触发actived钩子函数，然后触发updated钩子函数</p>
<h5 id="动态添加响应式数据"><a href="#动态添加响应式数据" class="headerlink" title="动态添加响应式数据"></a>动态添加响应式数据</h5><p>例子:<br>vm.$set(vm.obj, ‘name’, ‘zs’)<br>用法:<br>向响应式对象中添加一个property，并确保这个新property同样是响应式的，且触发视图更新。它必须用于向响应式对象上添加新<br>property，因为Vue无法探测普通的新增property (比如<br>this.my0bject.newProperty = ‘hi’ )<br>!注意对象不能是Vue实例，或者Vue实例的根数据对象。</p>
<p>watcher和set类似</p>
<p>nexTick是在dom行程后获取内容,本身是一个微任务,运行环境不支持时降级为宏任务,</p>
<h5 id="为什么要使用虚拟DOM"><a href="#为什么要使用虚拟DOM" class="headerlink" title="为什么要使用虚拟DOM"></a>为什么要使用虚拟DOM</h5><ul>
<li>避免直接操作DOM,提高开发效率</li>
<li>作为一个中间层可以跨平台</li>
<li>虚拟DOM不一定可以提高性能</li>
<li>首次渲染的时候会增加开销</li>
<li>复杂视图情况下提升渲染性能</li>
</ul>
<h4 id="vnode的创建过程"><a href="#vnode的创建过程" class="headerlink" title="vnode的创建过程"></a>vnode的创建过程</h4><p>render函数返回vnode<br>update函数把虚拟dom渲染成真实dom<br>执行__patch__函数设置modules和nodeops，返回patch函数<br>patch函数</p>
<h5 id="虚拟dom创建的整体过程"><a href="#虚拟dom创建的整体过程" class="headerlink" title="虚拟dom创建的整体过程"></a>虚拟dom创建的整体过程</h5><p>vm._render()<br>vnode = render.call(vm._renderProxy, vm.$createElement)</p>
<p>vm.$createElement()<br>h函教,用户设置的render函数中调用<br>createElement(vm, a, b.c.d, true)</p>
<p>vm._c()<br>h函数。模板编译的render函数中调用<br>createElement(vm,a,b.c.d, true)</p>
<p>createElement()<br>vnode = new VNode( config.parsePlatformTagName(tag). data,children, undefined, undefined, context )<br>vm._render()结束，返回vnode</p>
<p>vm._update()<br>负责把虚拟 DOM，渲染成真实DOM<br>首次执行 vm. patch vm.$el, vnode,hydrating.false)<br>数据更新 vm.patch  (prevVnode, vnode)</p>
<p>vm.__patch__()<br>runtimefindexjs中挂载vue.prototype.__patch__<br>runtime/patch.js 的patch函数<br>设置modules和nodeOps<br>调用createPatchFunction0函数返回patch函数</p>
<p>patch()<br>vdom/patch.js 中的createPatchFunction返回patch函数<br>挂载cbs节点的属性/事件/样式操作的钩了函数<br>判断第一个参数是真实DOM还是虚拟 DOM.首次加载,第个参数就是真实DOM，转换成VNode，调用createElm<br>如里是数据更新的时候,新旧节点是samevnode执行 patchVnode,也就是 Diff<br>删除旧节点</p>
<p>createElm(vnode,insertedVnodeQueue)<br>把虚拟节点,转换为真实DOM，并插入到DOM树<br>把虚拟节点的children，转换为真实DOM，并插入到DOM树</p>
<p>patchVnode<br>对比新旧VNode，以及新旧VNode的了节点更新差异<br>如果新旧VNode都有了节点并且了节点不同的话，会调用updateChildren对比子节点的差异</p>
<p>updatechildren<br>从头和尾开始依次找到相同的了节点进行比较patchVnode，总共有四种比较方式<br>在老节点的了节点中查找newStartVnode，并进行处理<br>如果新节点比老节点多，把新增的了节点插入到DOM中<br>如果老节点比新节点多，把多余的老节点删除
　</p>
<h5 id="虚拟-DOM-中-Key-的作用和好处。"><a href="#虚拟-DOM-中-Key-的作用和好处。" class="headerlink" title="虚拟 DOM 中 Key 的作用和好处。"></a>虚拟 DOM 中 Key 的作用和好处。</h5><p>key主要用在Vue的虚拟DOM算法，在新旧nodes对比时辨识VNodes。如果不使用key，Vue会使用一种最大限度减少动态元素并且尽可能的尝试就地修改\复用相同类型元素的算法。而使用key时，它会基于key的变化重新排列元素顺序，并且会移除key不存在的元素。有相同父元素的子元素必须有独有的key。重复的key会造成渲染错误。<br>设置key比不设置的dom操作要少很多，减少diff和渲染所需要的时间，提升了性能。</p>
<h4 id="模板编译"><a href="#模板编译" class="headerlink" title="模板编译"></a>模板编译</h4><p> 模板编译的主要作用是将模板转换为渲染函数<br> 模板编译的作用</p>
<ul>
<li>Vue 2.x使用VNode描述视图以及各种交互，用户自己编写VNode 比较复杂</li>
<li>通过模板编译用户只需要编写类似HTML的代码</li>
<li>Vue.js模板，通过编译器将模板转换为返回 VNode 的render 函数</li>
<li>vue文件会被webpack在构建的过程中转换成render 函数</li>
</ul>
<h5 id="Vue-中模板编译的过程。"><a href="#Vue-中模板编译的过程。" class="headerlink" title="Vue 中模板编译的过程。"></a>Vue 中模板编译的过程。</h5><p>　<br>入口函数是compileToFunctions，在这个函数中先从缓存中加载编译好的render函数，如果缓存中没有的话就调用compile函数<br>在compile函数中，首先去合并options选项，然后调用baseCompile编译模板，compile的核心是合并选项，真正的处理是在baseCompile中完成的<br>把模板和合并后的选项传递给baseCompile函数，baseCompile完成了编译核心的以下三件事情<br>parse函数把模板转换成AST对象 也就是抽象语法树<br>optimize函数标记AST中的静态根节点，静态根节点不需要被重绘，patch的过程中会跳过静态根节点<br>generate函数把优化过后的AST对象转换成字符串形式的js代码<br>当compile执行完毕后，回到入口文件compileToFunctions，此处会继续把字符串形式的代码转换为函数的形式，然后调用createFuntion，当render和staticFuntion执行完毕，挂在到vue实例的options对应的属性上<br>所以，不要在代码中写入无意义的空白和换行，这些空白和换行都会被存储到内存中，对浏览器的渲染是毫无意义的
　</p>
<h4 id="写在最后"><a href="#写在最后" class="headerlink" title="写在最后"></a>写在最后</h4><p>原创博文, 如有错误, 敬请指导!</p>
 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/vue/" rel="tag">vue</a></li></ul>

    </footer>
  </div>

    
 
    
</article>

    
  </article>
  

  
  <nav class="page-nav">
    
    <a class="extend prev" rel="prev" href="/">上一页</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/3/">下一页</a>
  </nav>
  
</section>
</div>

      <footer class="footer">
  <div class="outer">
    <ul>
      <li>
        Copyrights &copy;
        2021-2022
        <i class="ri-heart-fill heart_icon"></i> levxn7
      </li>
    </ul>
    <ul>
      <li>
        
        
        
        由 <a href="https://hexo.io" target="_blank">Hexo</a> 强力驱动
        <span class="division">|</span>
        主题 - <a href="https://github.com/Shen-Yu/hexo-theme-ayer" target="_blank">Ayer</a>
        
      </li>
    </ul>
    <ul>
      <li>
        
        
        <span>
  <span><i class="ri-user-3-fill"></i>访问人数:<span id="busuanzi_value_site_uv"></span></span>
  <span class="division">|</span>
  <span><i class="ri-eye-fill"></i>浏览次数:<span id="busuanzi_value_page_pv"></span></span>
</span>
        
      </li>
    </ul>
    <ul>
      
    </ul>
    <ul>
      
    </ul>
    <ul>
      <li>
        <!-- cnzz统计 -->
        
        <script type="text/javascript" src='https://s9.cnzz.com/z_stat.php?id=1278069914&amp;web_id=1278069914'></script>
        
      </li>
    </ul>
  </div>
</footer>
      <div class="float_btns">
        <div class="totop" id="totop">
  <i class="ri-arrow-up-line"></i>
</div>

<div class="todark" id="todark">
  <i class="ri-moon-line"></i>
</div>

      </div>
    </main>
    <aside class="sidebar on">
      <button class="navbar-toggle"></button>
<nav class="navbar">
  
  <div class="logo">
    <a href="/"><img src="/images/xian.png" alt="就花荫"></a>
  </div>
  
  <ul class="nav nav-main">
    
    <li class="nav-item">
      <a class="nav-item-link" href="/">主页</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/archives">归档</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/categories">分类</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/tags">标签</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/about">关于我</a>
    </li>
    
  </ul>
</nav>
<nav class="navbar navbar-bottom">
  <ul class="nav">
    <li class="nav-item">
      
      <a class="nav-item-link nav-item-search"  title="搜索">
        <i class="ri-search-line"></i>
      </a>
      
      
      <a class="nav-item-link" target="_blank" href="/atom.xml" title="RSS Feed">
        <i class="ri-rss-line"></i>
      </a>
      
    </li>
  </ul>
</nav>
<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
    </aside>
    <div id="mask"></div>

<!-- #reward -->
<div id="reward">
  <span class="close"><i class="ri-close-line"></i></span>
  <p class="reward-p"><i class="ri-cup-line"></i>请我喝杯咖啡吧~</p>
  <div class="reward-box">
    
    <div class="reward-item">
      <img class="reward-img" src="/images/zfb.jpg">
      <span class="reward-type">支付宝</span>
    </div>
    
    
    <div class="reward-item">
      <img class="reward-img" src="/images/wx.jpg">
      <span class="reward-type">微信</span>
    </div>
    
  </div>
</div>
    
<script src="/js/jquery-2.0.3.min.js"></script>
 
<script src="/js/lazyload.min.js"></script>

<!-- Tocbot -->

<script src="https://cdn.jsdelivr.net/npm/jquery-modal@0.9.2/jquery.modal.min.js"></script>
<link
  rel="stylesheet"
  href="https://cdn.jsdelivr.net/npm/jquery-modal@0.9.2/jquery.modal.min.css"
/>
<script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js"></script>

<script src="/dist/main.js"></script>

<!-- ImageViewer -->
 <!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css">
<script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"></script>

<script>
    function viewer_init() {
        let pswpElement = document.querySelectorAll('.pswp')[0];
        let $imgArr = document.querySelectorAll(('.article-entry img:not(.reward-img)'))

        $imgArr.forEach(($em, i) => {
            $em.onclick = () => {
                // slider展开状态
                // todo: 这样不好，后面改成状态
                if (document.querySelector('.left-col.show')) return
                let items = []
                $imgArr.forEach(($em2, i2) => {
                    let img = $em2.getAttribute('data-idx', i2)
                    let src = $em2.getAttribute('data-target') || $em2.getAttribute('src')
                    let title = $em2.getAttribute('alt')
                    // 获得原图尺寸
                    const image = new Image()
                    image.src = src
                    items.push({
                        src: src,
                        w: image.width || $em2.width,
                        h: image.height || $em2.height,
                        title: title
                    })
                })
                var gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, items, {
                    index: parseInt(i)
                });
                gallery.init()
            }
        })
    }
    viewer_init()
</script> 
<!-- MathJax -->

<!-- Katex -->

<!-- busuanzi  -->
 
<script src="/js/busuanzi-2.3.pure.min.js"></script>
 
<!-- ClickLove -->
 
<script src="/js/clickLove.js"></script>
 
<!-- ClickBoom1 -->

<!-- ClickBoom2 -->

<!-- CodeCopy -->
 
<link rel="stylesheet" href="/css/clipboard.css">
 <script src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js"></script>
<script>
  function wait(callback, seconds) {
    var timelag = null;
    timelag = window.setTimeout(callback, seconds);
  }
  !function (e, t, a) {
    var initCopyCode = function(){
      var copyHtml = '';
      copyHtml += '<button class="btn-copy" data-clipboard-snippet="">';
      copyHtml += '<i class="ri-file-copy-2-line"></i><span>COPY</span>';
      copyHtml += '</button>';
      $(".highlight .code pre").before(copyHtml);
      $(".article pre code").before(copyHtml);
      var clipboard = new ClipboardJS('.btn-copy', {
        target: function(trigger) {
          return trigger.nextElementSibling;
        }
      });
      clipboard.on('success', function(e) {
        let $btn = $(e.trigger);
        $btn.addClass('copied');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-checkbox-circle-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPIED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('ri-checkbox-circle-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
      clipboard.on('error', function(e) {
        e.clearSelection();
        let $btn = $(e.trigger);
        $btn.addClass('copy-failed');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-time-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPY FAILED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('ri-time-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
    }
    initCopyCode();
  }(window, document);
</script>
 
<!-- CanvasBackground -->

<script>
  if (window.mermaid) {
    mermaid.initialize({ theme: "forest" });
  }
</script>


    
    <div id="music">
    
    
    
    <iframe frameborder="no" border="1" marginwidth="0" marginheight="0" width="200" height="52"
        src="//music.163.com/outchain/player?type=2&id=22707008&auto=1&height=32"></iframe>
</div>

<style>
    #music {
        position: fixed;
        right: 15px;
        bottom: 0;
        z-index: 998;
    }
</style>
    
  </div>
</body>

</html>